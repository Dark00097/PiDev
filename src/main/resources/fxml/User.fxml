<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.shape.*?>
<?import javafx.collections.FXCollections?>
<?import java.lang.String?>

<VBox xmlns="http://javafx.com/javafx/17"
      xmlns:fx="http://javafx.com/fxml/1"
      fx:controller="com.nexora.bank.controllers.UserController"
      stylesheets="@../css/User.css"
      styleClass="nx-entity-container nx-module-content" spacing="24">

    <!-- PAGE HEADER -->
    <HBox styleClass="nx-page-header" alignment="CENTER_LEFT">
        <VBox spacing="4">
            <Label text="Gestion Utilisateurs" styleClass="nx-page-title"/>
            <Label text="Creer, modifier et gerer les comptes utilisateurs" styleClass="nx-page-subtitle"/>
        </VBox>
    </HBox>

    <!-- STAT CARDS -->
    <HBox spacing="24" styleClass="nx-stats-row">
        <VBox styleClass="nx-stat-card nx-stat-card-animated" HBox.hgrow="ALWAYS">
            <HBox alignment="CENTER_LEFT" spacing="16">
                <StackPane styleClass="nx-stat-card-icon, nx-stat-card-icon-teal">
                    <SVGPath content="M17 20h5v-2a3 3 0 0 0-5.356-1.857M17 20H7"/>
                </StackPane>
                <VBox spacing="4">
                    <Label fx:id="lblTotalUsers" text="0" styleClass="nx-stat-card-value"/>
                    <Label text="Total Utilisateurs" styleClass="nx-stat-card-label"/>
                </VBox>
            </HBox>
        </VBox>

        <VBox styleClass="nx-stat-card nx-stat-card-animated" HBox.hgrow="ALWAYS">
            <HBox alignment="CENTER_LEFT" spacing="16">
                <StackPane styleClass="nx-stat-card-icon, nx-stat-card-icon-success">
                    <SVGPath content="M9 12l2 2 4-4m6 2a9 9 0 1 1-18 0 9 9 0 0 1 18 0z"/>
                </StackPane>
                <VBox spacing="4">
                    <Label fx:id="lblUsersActifs" text="0" styleClass="nx-stat-card-value"/>
                    <Label text="Utilisateurs Actifs" styleClass="nx-stat-card-label"/>
                </VBox>
            </HBox>
        </VBox>

        <VBox styleClass="nx-stat-card nx-stat-card-animated" HBox.hgrow="ALWAYS">
            <HBox alignment="CENTER_LEFT" spacing="16">
                <StackPane styleClass="nx-stat-card-icon, nx-stat-card-icon-purple">
                    <SVGPath content="M12 4.354a4 4 0 1 1 0 5.292M15 21H3v-1a6 6 0 0 1 12 0v1zm0 0h6v-1a6 6 0 0 0-9-5.197"/>
                </StackPane>
                <VBox spacing="4">
                    <Label fx:id="lblAdmins" text="0" styleClass="nx-stat-card-value"/>
                    <Label text="Administrateurs" styleClass="nx-stat-card-label"/>
                </VBox>
            </HBox>
        </VBox>
    </HBox>

    <HBox spacing="24" VBox.vgrow="ALWAYS">
        <!-- TABLE -->
        <VBox styleClass="nx-table-card" HBox.hgrow="ALWAYS" spacing="0">
            <HBox styleClass="nx-table-header" alignment="CENTER_LEFT" spacing="12">
                <VBox spacing="4" HBox.hgrow="ALWAYS">
                    <Label text="Liste des Utilisateurs" styleClass="nx-table-title"/>
                    <Label text="Recherche et gestion en temps reel" styleClass="nx-table-subtitle"/>
                </VBox>
                <TextField fx:id="txtRecherche" promptText="Rechercher..." styleClass="nx-search-input-sm" prefWidth="200"/>
                <Button text="Export PDF" styleClass="nx-btn, nx-btn-outline, nx-btn-sm" onAction="#exporterPDF"/>
            </HBox>

            <VBox styleClass="nx-table-container" VBox.vgrow="ALWAYS">
                <TableView fx:id="tableUsers" styleClass="nx-table" VBox.vgrow="ALWAYS">
                    <columns>
                        <TableColumn fx:id="colNom" text="Nom" prefWidth="120"/>
                        <TableColumn fx:id="colPrenom" text="Prenom" prefWidth="120"/>
                        <TableColumn fx:id="colEmail" text="Email" prefWidth="200"/>
                        <TableColumn fx:id="colTelephone" text="Telephone" prefWidth="130"/>
                        <TableColumn fx:id="colRole" text="Role" prefWidth="120"/>
                        <TableColumn fx:id="colStatut" text="Statut" prefWidth="100"/>
                        <TableColumn fx:id="colActions" text="Actions" prefWidth="190"/>
                    </columns>
                </TableView>
            </VBox>

            <HBox styleClass="nx-card-footer, nx-table-footer" alignment="CENTER" spacing="16">
                <Label fx:id="lblTableInfo" text="Affichage de 0 entrees" styleClass="nx-table-info"/>
                <Region HBox.hgrow="ALWAYS"/>
                <Button text="Relancer Pending (Email)" styleClass="nx-btn, nx-btn-gold" onAction="#envoyerSMS"/>
            </HBox>
        </VBox>

        <!-- FORM -->
        <VBox styleClass="nx-card" prefWidth="560" minWidth="560" spacing="0">
            <HBox styleClass="nx-card-header" alignment="CENTER_LEFT" spacing="12">
                <StackPane styleClass="nx-card-header-icon, nx-card-header-icon-purple">
                    <SVGPath content="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2M12 7a4 4 0 1 0 0-8 4 4 0 0 0 0 8z"/>
                </StackPane>
                <VBox spacing="2">
                    <Label text="Utilisateur" styleClass="nx-card-title"/>
                    <Label text="Gerer les utilisateurs du systeme" styleClass="nx-card-subtitle"/>
                </VBox>
            </HBox>

            <ScrollPane styleClass="nx-form-scroll" fitToWidth="true" VBox.vgrow="ALWAYS">
                <VBox styleClass="nx-card-body" spacing="16">
                    <VBox styleClass="nx-form-group" spacing="8">
                        <Label text="Nom" styleClass="nx-label, nx-label-required"/>
                        <TextField fx:id="txtNom" promptText="Nom de famille" styleClass="nx-input"/>
                    </VBox>

                    <VBox styleClass="nx-form-group" spacing="8">
                        <Label text="Prenom" styleClass="nx-label, nx-label-required"/>
                        <TextField fx:id="txtPrenom" promptText="Prenom" styleClass="nx-input"/>
                    </VBox>

                    <VBox styleClass="nx-form-group" spacing="8">
                        <Label text="Email" styleClass="nx-label, nx-label-required"/>
                        <TextField fx:id="txtEmail" promptText="email@exemple.com" styleClass="nx-input"/>
                    </VBox>

                    <VBox styleClass="nx-form-group" spacing="8">
                        <Label text="Telephone" styleClass="nx-label"/>
                        <TextField fx:id="txtTelephone" promptText="+216 XX XXX XXX" styleClass="nx-input"/>
                    </VBox>

                    <VBox styleClass="nx-form-group" spacing="8">
                        <Label text="Mot de passe (gestion admin)" styleClass="nx-label"/>
                        <PasswordField fx:id="txtNewPassword" promptText="Laisser vide pour ne pas changer" styleClass="nx-input"/>
                    </VBox>

                    <VBox styleClass="nx-form-group" spacing="8">
                        <Label text="Role" styleClass="nx-label, nx-label-required"/>
                        <ComboBox fx:id="cmbRole" promptText="Selectionner un role" styleClass="nx-select" maxWidth="Infinity">
                            <items>
                                <FXCollections fx:factory="observableArrayList">
                                    <String fx:value="ROLE_USER"/>
                                    <String fx:value="ROLE_ADMIN"/>
                                </FXCollections>
                            </items>
                        </ComboBox>
                    </VBox>

                    <VBox styleClass="nx-form-group" spacing="8">
                        <Label text="Statut" styleClass="nx-label, nx-label-required"/>
                        <ComboBox fx:id="cmbStatut" promptText="Selectionner un statut" styleClass="nx-select" maxWidth="Infinity">
                            <items>
                                <FXCollections fx:factory="observableArrayList">
                                    <String fx:value="PENDING"/>
                                    <String fx:value="ACTIVE"/>
                                    <String fx:value="DECLINED"/>
                                    <String fx:value="INACTIVE"/>
                                    <String fx:value="BANNED"/>
                                </FXCollections>
                            </items>
                        </ComboBox>
                    </VBox>
                </VBox>
            </ScrollPane>

            <HBox styleClass="nx-card-footer" spacing="12" alignment="CENTER_RIGHT">
                <Button text="Annuler" styleClass="nx-btn, nx-btn-outline" onAction="#handleAnnuler"/>
                <Button text="Changer Mot de Passe" styleClass="nx-btn, nx-btn-secondary" onAction="#handleUpdatePasswordSelected"/>
                <Button text="Approuver (Selection)" styleClass="nx-btn, nx-btn-success" onAction="#handleApproveSelected"/>
                <Button text="Refuser (Selection)" styleClass="nx-btn, nx-btn-danger-soft" onAction="#handleDeclineSelected"/>
                <Button text="Supprimer" styleClass="nx-btn, nx-btn-danger" onAction="#handleSupprimer"/>
                <Button fx:id="btnAjouter" text="Ajouter / Enregistrer" styleClass="nx-btn, nx-btn-primary" onAction="#handleAjouter"/>
            </HBox>
        </VBox>
    </HBox>

    <VBox styleClass="nx-ban-section" spacing="14">
        <HBox alignment="CENTER_LEFT" spacing="12">
            <StackPane styleClass="nx-card-header-icon, nx-card-header-icon-teal">
                <SVGPath content="M12 2a10 10 0 1 0 10 10A10 10 0 0 0 12 2zm0 14a1.5 1.5 0 1 1 1.5-1.5A1.5 1.5 0 0 1 12 16zm1.1-5.7-.4 2.5a.7.7 0 0 1-1.4 0l-.4-2.5a1.1 1.1 0 1 1 2.2 0z"/>
            </StackPane>
            <VBox spacing="2">
                <Label text="Ban / Unban Management" styleClass="nx-card-title"/>
                <Label text="Selected user" styleClass="nx-card-subtitle"/>
            </VBox>
            <Region HBox.hgrow="ALWAYS"/>
            <Label fx:id="lblBanTarget" text="No user selected" styleClass="nx-ban-target"/>
        </HBox>

        <HBox spacing="12" alignment="CENTER_LEFT">
            <TextArea fx:id="txtBanReason" promptText="Ban reason (required for ban)" prefRowCount="2" wrapText="true" styleClass="nx-input, nx-ban-reason" HBox.hgrow="ALWAYS"/>
            <Button text="Ban Selected User" styleClass="nx-btn, nx-btn-danger" onAction="#handleBanSelectedUser"/>
            <Button text="Unban Selected User" styleClass="nx-btn, nx-btn-success" onAction="#handleUnbanSelectedUser"/>
        </HBox>
    </VBox>
</VBox>
