<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.shape.*?>
<?import javafx.scene.chart.*?>
<?import javafx.geometry.Insets?>

<VBox xmlns="http://javafx.com/javafx/17" 
      xmlns:fx="http://javafx.com/fxml/1" 
      fx:controller="com.nexora.bank.controllers.StatisticsController"
      stylesheets="@../css/Statistics.css"
      styleClass="nx-entity-container" spacing="24">

    <!-- Page Header -->
    <HBox styleClass="nx-page-header" alignment="CENTER_LEFT">
        <VBox spacing="4">
            <Label text="Statistiques" styleClass="nx-page-title"/>
            <Label text="Vue d'ensemble des données et indicateurs" styleClass="nx-page-subtitle"/>
        </VBox>
        <Region HBox.hgrow="ALWAYS"/>
        <HBox spacing="12">
            <ComboBox fx:id="cmbPeriode" value="Ce mois" styleClass="nx-select">
                <items>
                    <FXCollections fx:factory="observableArrayList">
                        <String fx:value="Aujourd'hui"/>
                        <String fx:value="Cette semaine"/>
                        <String fx:value="Ce mois"/>
                        <String fx:value="Ce trimestre"/>
                        <String fx:value="Cette année"/>
                    </FXCollections>
                </items>
            </ComboBox>
            <Button text="Actualiser" styleClass="nx-btn, nx-btn-primary" onAction="#refreshStats">
                <graphic>
                    <SVGPath content="M23 4v6h-6M1 20v-6h6M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15" styleClass="nx-btn-icon"/>
                </graphic>
            </Button>
        </HBox>
    </HBox>

    <!-- Stats Overview Cards -->
    <HBox spacing="24" styleClass="nx-stats-row">
        <VBox styleClass="nx-stat-card, nx-stat-card-highlight" HBox.hgrow="ALWAYS">
            <HBox alignment="CENTER_LEFT" spacing="16">
                <StackPane styleClass="nx-stat-card-icon, nx-stat-card-icon-teal">
                    <SVGPath content="M12 1v22M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
                </StackPane>
                <VBox spacing="4" HBox.hgrow="ALWAYS">
                    <Label fx:id="lblTotalRevenu" text="2,450,000 DT" styleClass="nx-stat-card-value-lg"/>
                    <Label text="Revenu Total" styleClass="nx-stat-card-label"/>
                    <HBox spacing="8" alignment="CENTER_LEFT">
                        <Label text="+12.5%" styleClass="nx-stat-badge, nx-stat-badge-success"/>
                        <Label text="vs mois précédent" styleClass="nx-stat-card-compare"/>
                    </HBox>
                </VBox>
            </HBox>
        </VBox>

        <VBox styleClass="nx-stat-card" HBox.hgrow="ALWAYS">
            <HBox alignment="CENTER_LEFT" spacing="16">
                <StackPane styleClass="nx-stat-card-icon, nx-stat-card-icon-blue">
                    <SVGPath content="M17 20h5v-2a3 3 0 0 0-5.356-1.857M17 20H7"/>
                </StackPane>
                <VBox spacing="4" HBox.hgrow="ALWAYS">
                    <Label fx:id="lblTotalClients" text="1,234" styleClass="nx-stat-card-value-lg"/>
                    <Label text="Total Clients" styleClass="nx-stat-card-label"/>
                    <HBox spacing="8" alignment="CENTER_LEFT">
                        <Label text="+8.3%" styleClass="nx-stat-badge, nx-stat-badge-success"/>
                        <Label text="vs mois précédent" styleClass="nx-stat-card-compare"/>
                    </HBox>
                </VBox>
            </HBox>
        </VBox>

        <VBox styleClass="nx-stat-card" HBox.hgrow="ALWAYS">
            <HBox alignment="CENTER_LEFT" spacing="16">
                <StackPane styleClass="nx-stat-card-icon, nx-stat-card-icon-gold">
                    <SVGPath content="M17 1l4 4-4 4M3 11V9a4 4 0 0 1 4-4h14"/>
                </StackPane>
                <VBox spacing="4" HBox.hgrow="ALWAYS">
                    <Label fx:id="lblTotalTransactions" text="5,678" styleClass="nx-stat-card-value-lg"/>
                    <Label text="Transactions" styleClass="nx-stat-card-label"/>
                    <HBox spacing="8" alignment="CENTER_LEFT">
                        <Label text="+15.2%" styleClass="nx-stat-badge, nx-stat-badge-success"/>
                        <Label text="vs mois précédent" styleClass="nx-stat-card-compare"/>
                    </HBox>
                </VBox>
            </HBox>
        </VBox>

        <VBox styleClass="nx-stat-card" HBox.hgrow="ALWAYS">
            <HBox alignment="CENTER_LEFT" spacing="16">
                <StackPane styleClass="nx-stat-card-icon, nx-stat-card-icon-success">
                    <SVGPath content="M9 12l2 2 4-4m6 2a9 9 0 1 1-18 0 9 9 0 0 1 18 0z"/>
                </StackPane>
                <VBox spacing="4" HBox.hgrow="ALWAYS">
                    <Label fx:id="lblCreditsApprouves" text="89" styleClass="nx-stat-card-value-lg"/>
                    <Label text="Crédits Approuvés" styleClass="nx-stat-card-label"/>
                    <HBox spacing="8" alignment="CENTER_LEFT">
                        <Label text="-3.1%" styleClass="nx-stat-badge, nx-stat-badge-error"/>
                        <Label text="vs mois précédent" styleClass="nx-stat-card-compare"/>
                    </HBox>
                </VBox>
            </HBox>
        </VBox>
    </HBox>

    <!-- Charts Row -->
    <HBox spacing="24" VBox.vgrow="ALWAYS">
        <!-- Line Chart - Transactions -->
        <VBox styleClass="nx-card" HBox.hgrow="ALWAYS" spacing="0">
            <HBox styleClass="nx-card-header" alignment="CENTER_LEFT">
                <VBox spacing="2">
                    <Label text="Évolution des Transactions" styleClass="nx-card-title"/>
                    <Label text="Transactions mensuelles sur l'année" styleClass="nx-card-subtitle"/>
                </VBox>
            </HBox>
            <VBox styleClass="nx-card-body" VBox.vgrow="ALWAYS">
                <LineChart fx:id="chartTransactions" VBox.vgrow="ALWAYS" styleClass="nx-chart">
                    <xAxis><CategoryAxis label="Mois"/></xAxis>
                    <yAxis><NumberAxis label="Montant (DT)"/></yAxis>
                </LineChart>
            </VBox>
        </VBox>

        <!-- Pie Chart - Répartition -->
        <VBox styleClass="nx-card" prefWidth="400" spacing="0">
            <HBox styleClass="nx-card-header" alignment="CENTER_LEFT">
                <VBox spacing="2">
                    <Label text="Répartition des Comptes" styleClass="nx-card-title"/>
                    <Label text="Par type de compte" styleClass="nx-card-subtitle"/>
                </VBox>
            </HBox>
            <VBox styleClass="nx-card-body" alignment="CENTER" VBox.vgrow="ALWAYS">
                <PieChart fx:id="chartComptes" styleClass="nx-chart" legendVisible="true"/>
            </VBox>
        </VBox>
    </HBox>

    <!-- Second Charts Row -->
    <HBox spacing="24">
        <!-- Bar Chart - Crédits -->
        <VBox styleClass="nx-card" HBox.hgrow="ALWAYS" spacing="0">
            <HBox styleClass="nx-card-header" alignment="CENTER_LEFT">
                <VBox spacing="2">
                    <Label text="Crédits par Type" styleClass="nx-card-title"/>
                    <Label text="Montants accordés par catégorie" styleClass="nx-card-subtitle"/>
                </VBox>
            </HBox>
            <VBox styleClass="nx-card-body" VBox.vgrow="ALWAYS">
                <BarChart fx:id="chartCredits" VBox.vgrow="ALWAYS" styleClass="nx-chart">
                    <xAxis><CategoryAxis label="Type"/></xAxis>
                    <yAxis><NumberAxis label="Montant (DT)"/></yAxis>
                </BarChart>
            </VBox>
        </VBox>

        <!-- Recent Activity -->
        <VBox styleClass="nx-card" prefWidth="400" spacing="0">
            <HBox styleClass="nx-card-header" alignment="CENTER_LEFT">
                <VBox spacing="2" HBox.hgrow="ALWAYS">
                    <Label text="Activité Récente" styleClass="nx-card-title"/>
                    <Label text="Dernières opérations" styleClass="nx-card-subtitle"/>
                </VBox>
                <Button text="Voir tout" styleClass="nx-btn, nx-btn-ghost-sm"/>
            </HBox>
            <VBox styleClass="nx-card-body" spacing="0">
                <ListView fx:id="listActivites" styleClass="nx-activity-list"/>
            </VBox>
        </VBox>
    </HBox>
</VBox>
