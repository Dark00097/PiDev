<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.shape.*?>
<?import javafx.geometry.Insets?>
<?import javafx.collections.FXCollections?>
<?import java.lang.String?>

<VBox xmlns="http://javafx.com/javafx/17" 
      xmlns:fx="http://javafx.com/fxml/1" 
      fx:controller="com.nexora.bank.controllers.PartenaireController"
      stylesheets="@../css/Partenaire.css"
      styleClass="nx-entity-container" spacing="24">

    <!-- ============================================= -->
    <!-- STAT CARDS (Mini Dashboard) -->
    <!-- ============================================= -->
    <HBox spacing="24" styleClass="nx-stats-row">
        <!-- Stat Card 1: Partenaires Actifs -->
        <VBox styleClass="nx-stat-card" HBox.hgrow="ALWAYS">
            <HBox alignment="CENTER_LEFT" spacing="16">
                <StackPane styleClass="nx-stat-card-icon, nx-stat-card-icon-teal">
                    <SVGPath content="M17 20h5v-2a3 3 0 0 0-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 0 1 5.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 0 1 9.288 0M15 7a3 3 0 1 1-6 0 3 3 0 0 1 6 0zm6 3a2 2 0 1 1-4 0 2 2 0 0 1 4 0zM7 10a2 2 0 1 1-4 0 2 2 0 0 1 4 0z"/>
                </StackPane>
                <VBox spacing="4">
                    <Label fx:id="lblPartenairesActifs" text="0" styleClass="nx-stat-card-value"/>
                    <Label text="Partenaires Actifs" styleClass="nx-stat-card-label"/>
                </VBox>
                <Region HBox.hgrow="ALWAYS"/>
                <VBox alignment="CENTER_RIGHT">
                    <Label text="+15%" styleClass="nx-stat-badge, nx-stat-badge-success"/>
                </VBox>
            </HBox>
        </VBox>

        <!-- Stat Card 2: Offres Disponibles -->
        <VBox styleClass="nx-stat-card" HBox.hgrow="ALWAYS">
            <HBox alignment="CENTER_LEFT" spacing="16">
                <StackPane styleClass="nx-stat-card-icon, nx-stat-card-icon-gold">
                    <SVGPath content="M12 8v13m0-13V6a2 2 0 1 1 2 2h-2zm0 0V5.5A2.5 2.5 0 1 0 9.5 8H12zm-7 4h14M5 12a2 2 0 1 1 0-4h14a2 2 0 1 1 0 4M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2v-7"/>
                </StackPane>
                <VBox spacing="4">
                    <Label fx:id="lblOffresDisponibles" text="0" styleClass="nx-stat-card-value"/>
                    <Label text="Offres Disponibles" styleClass="nx-stat-card-label"/>
                </VBox>
                <Region HBox.hgrow="ALWAYS"/>
                <VBox alignment="CENTER_RIGHT">
                    <Label text="+8%" styleClass="nx-stat-badge, nx-stat-badge-success"/>
                </VBox>
            </HBox>
        </VBox>

        <!-- Stat Card 3: Partenaires Premium -->
        <VBox styleClass="nx-stat-card" HBox.hgrow="ALWAYS">
            <HBox alignment="CENTER_LEFT" spacing="16">
                <StackPane styleClass="nx-stat-card-icon, nx-stat-card-icon-purple">
                    <SVGPath content="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"/>
                </StackPane>
                <VBox spacing="4">
                    <Label fx:id="lblPartenairesPremium" text="0" styleClass="nx-stat-card-value"/>
                    <Label text="Partenaires Premium" styleClass="nx-stat-card-label"/>
                </VBox>
                <Region HBox.hgrow="ALWAYS"/>
                <VBox alignment="CENTER_RIGHT">
                    <Label text="+20%" styleClass="nx-stat-badge, nx-stat-badge-success"/>
                </VBox>
            </HBox>
        </VBox>
    </HBox>

    <!-- ============================================= -->
    <!-- MAIN CONTENT: FORM + TABLE -->
    <!-- ============================================= -->
    <HBox spacing="24" VBox.vgrow="ALWAYS">
        
        <!-- ============================================= -->
        <!-- FORM SECTION -->
        <!-- ============================================= -->
        <VBox styleClass="nx-card" prefWidth="560" minWidth="560" spacing="0">
            <!-- Form Header -->
            <HBox styleClass="nx-card-header" alignment="CENTER_LEFT" spacing="12">
                <StackPane styleClass="nx-card-header-icon, nx-card-header-icon-purple">
                    <SVGPath content="M17 20h5v-2a3 3 0 0 0-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857"/>
                </StackPane>
                <VBox spacing="2">
                    <Label text="Partenaire" styleClass="nx-card-title"/>
                    <Label text="Gerer les partenaires commerciaux" styleClass="nx-card-subtitle"/>
                </VBox>
            </HBox>

            <!-- Form Body -->
            <ScrollPane styleClass="nx-form-scroll" fitToWidth="true" VBox.vgrow="ALWAYS">
                <VBox styleClass="nx-card-body" spacing="16">
                    
                    <!-- Nom -->
                    <VBox styleClass="nx-form-group" spacing="8">
                        <Label text="Nom du Partenaire" styleClass="nx-label, nx-label-required"/>
                        <HBox styleClass="nx-input-wrapper">
                            <SVGPath content="M19 21V5a2 2 0 0 0-2-2H7a2 2 0 0 0-2 2v16m14 0H5m14 0h2m-2 0v-4" styleClass="nx-input-icon"/>
                            <TextField fx:id="txtNom" promptText="Ex: Carrefour, Zara..." styleClass="nx-input" HBox.hgrow="ALWAYS"/>
                        </HBox>
                    </VBox>

                    <!-- Categorie -->
                    <VBox styleClass="nx-form-group" spacing="8">
                        <Label text="Categorie" styleClass="nx-label, nx-label-required"/>
                        <ComboBox fx:id="cmbCategorie" promptText="Selectionner une categorie" styleClass="nx-select" maxWidth="Infinity">
                            <items>
                                <FXCollections fx:factory="observableArrayList">
                                    <String fx:value="Grande Distribution"/>
                                    <String fx:value="Mode et Vetements"/>
                                    <String fx:value="Electronique"/>
                                    <String fx:value="Restauration"/>
                                    <String fx:value="Voyage et Tourisme"/>
                                    <String fx:value="Sante et Bien-etre"/>
                                    <String fx:value="Services"/>
                                    <String fx:value="Divertissement"/>
                                </FXCollections>
                            </items>
                        </ComboBox>
                    </VBox>

                    <!-- Description -->
                    <VBox styleClass="nx-form-group" spacing="8">
                        <Label text="Description" styleClass="nx-label"/>
                        <TextArea fx:id="txtDescription" promptText="Description du partenaire et des offres..." styleClass="nx-textarea" prefRowCount="3"/>
                    </VBox>

                    <!-- Taux Cashback -->
                    <VBox styleClass="nx-form-group" spacing="8">
                        <Label text="Taux Cashback (%)" styleClass="nx-label, nx-label-required"/>
                        <HBox styleClass="nx-input-wrapper">
                            <SVGPath content="M9 14l6-6m-5.5.5h.01m4.99 5h.01M19 21V5a2 2 0 0 0-2-2H7a2 2 0 0 0-2 2v16" styleClass="nx-input-icon"/>
                            <TextField fx:id="txtTauxCashback" promptText="Ex: 5" styleClass="nx-input" HBox.hgrow="ALWAYS"/>
                        </HBox>
                        <Label text="Pourcentage de cashback offert sur les achats" styleClass="nx-helper-text"/>
                    </VBox>

                    <!-- Taux Cashback Max -->
                    <VBox styleClass="nx-form-group" spacing="8">
                        <Label text="Taux Cashback Maximum (%)" styleClass="nx-label"/>
                        <HBox styleClass="nx-input-wrapper">
                            <SVGPath content="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" styleClass="nx-input-icon"/>
                            <TextField fx:id="txtTauxCashbackMax" promptText="Ex: 15" styleClass="nx-input" HBox.hgrow="ALWAYS"/>
                        </HBox>
                        <Label text="Taux maximum lors des promotions" styleClass="nx-helper-text"/>
                    </VBox>

                    <!-- Plafond Mensuel -->
                    <VBox styleClass="nx-form-group" spacing="8">
                        <Label text="Plafond Mensuel (DT)" styleClass="nx-label"/>
                        <HBox styleClass="nx-input-wrapper">
                            <SVGPath content="M12 1v22M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6" styleClass="nx-input-icon"/>
                            <TextField fx:id="txtPlafondMensuel" promptText="Ex: 100" styleClass="nx-input" HBox.hgrow="ALWAYS"/>
                        </HBox>
                        <Label text="Montant maximum de cashback par mois" styleClass="nx-helper-text"/>
                    </VBox>

                    <!-- Conditions -->
                    <VBox styleClass="nx-form-group" spacing="8">
                        <Label text="Conditions" styleClass="nx-label"/>
                        <TextArea fx:id="txtConditions" promptText="Conditions d'utilisation, restrictions..." styleClass="nx-textarea" prefRowCount="2"/>
                    </VBox>

                    <!-- Statut Partenaire -->
                    <VBox styleClass="nx-form-group" spacing="8">
                        <Label text="Statut" styleClass="nx-label, nx-label-required"/>
                        <ComboBox fx:id="cmbStatut" promptText="Selectionner un statut" styleClass="nx-select" maxWidth="Infinity">
                            <items>
                                <FXCollections fx:factory="observableArrayList">
                                    <String fx:value="Actif"/>
                                    <String fx:value="Inactif"/>
                                    <String fx:value="Premium"/>
                                    <String fx:value="Suspendu"/>
                                </FXCollections>
                            </items>
                        </ComboBox>
                    </VBox>
                </VBox>
            </ScrollPane>

            <!-- Form Footer with Buttons -->
            <HBox styleClass="nx-card-footer" spacing="12" alignment="CENTER_RIGHT">
                <Button fx:id="btnAnnuler" text="Annuler" styleClass="nx-btn, nx-btn-outline" onAction="#handleAnnuler">
                    <graphic>
                        <SVGPath content="M6 18L18 6M6 6l12 12" styleClass="nx-btn-icon"/>
                    </graphic>
                </Button>
                <Button fx:id="btnSupprimer" text="Supprimer" styleClass="nx-btn, nx-btn-danger" onAction="#handleSupprimer">
                    <graphic>
                        <SVGPath content="M19 7l-.867 12.142A2 2 0 0 1 16.138 21H7.862a2 2 0 0 1-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v3M4 7h16" styleClass="nx-btn-icon"/>
                    </graphic>
                </Button>
                <Button fx:id="btnAjouter" text="Ajouter" styleClass="nx-btn, nx-btn-primary" onAction="#handleAjouter">
                    <graphic>
                        <SVGPath content="M12 5v14M5 12h14" styleClass="nx-btn-icon"/>
                    </graphic>
                </Button>
            </HBox>
        </VBox>

        <!-- ============================================= -->
        <!-- TABLE SECTION -->
        <!-- ============================================= -->
        <VBox styleClass="nx-card" HBox.hgrow="ALWAYS" spacing="0">
            <!-- Table Header -->
            <HBox styleClass="nx-card-header" alignment="CENTER_LEFT" spacing="16">
                <VBox spacing="2" HBox.hgrow="ALWAYS">
                    <Label text="Liste des Partenaires" styleClass="nx-card-title"/>
                    <Label text="Gerer tous les partenaires commerciaux" styleClass="nx-card-subtitle"/>
                </VBox>

                <!-- Search Box -->
                <HBox styleClass="nx-table-search" alignment="CENTER_LEFT" spacing="8">
                    <SVGPath content="M21 21l-6-6m2-5a7 7 0 1 1-14 0 7 7 0 0 1 14 0z" styleClass="nx-search-icon-sm"/>
                    <TextField fx:id="txtRecherche" promptText="Rechercher..." styleClass="nx-search-input-sm" prefWidth="200"/>
                </HBox>

                <!-- Sort Button -->
                <MenuButton text="Trier" styleClass="nx-btn, nx-btn-outline-sm">
                    <graphic>
                        <SVGPath content="M3 6h18M6 12h12M9 18h6" styleClass="nx-btn-icon"/>
                    </graphic>
                    <items>
                        <MenuItem text="Par Nom" onAction="#trierParNom"/>
                        <MenuItem text="Par Categorie" onAction="#trierParCategorie"/>
                        <MenuItem text="Par Taux Cashback" onAction="#trierParTaux"/>
                        <MenuItem text="Par Statut" onAction="#trierParStatut"/>
                    </items>
                </MenuButton>

                <!-- Export PDF Button -->
                <Button text="Export PDF" styleClass="nx-btn, nx-btn-secondary-sm" onAction="#exporterPDF">
                    <graphic>
                        <SVGPath content="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z M14 2v6h6" styleClass="nx-btn-icon"/>
                    </graphic>
                </Button>
            </HBox>

            <!-- Table Body -->
            <VBox styleClass="nx-table-container" VBox.vgrow="ALWAYS">
                <TableView fx:id="tablePartenaires" styleClass="nx-table" VBox.vgrow="ALWAYS">
                    <columns>
                        <TableColumn fx:id="colNom" text="Nom" prefWidth="150"/>
                        <TableColumn fx:id="colCategorie" text="Categorie" prefWidth="140"/>
                        <TableColumn fx:id="colTaux" text="Taux %" prefWidth="80"/>
                        <TableColumn fx:id="colTauxMax" text="Max %" prefWidth="80"/>
                        <TableColumn fx:id="colPlafond" text="Plafond" prefWidth="100"/>
                        <TableColumn fx:id="colDescription" text="Description" prefWidth="180"/>
                        <TableColumn fx:id="colStatut" text="Statut" prefWidth="100"/>
                        <TableColumn fx:id="colActions" text="Actions" prefWidth="100"/>
                    </columns>
                    <placeholder>
                        <VBox alignment="CENTER" spacing="16" styleClass="nx-table-empty">
                            <SVGPath content="M17 20h5v-2a3 3 0 0 0-5.356-1.857M17 20H7" styleClass="nx-empty-icon"/>
                            <Label text="Aucun partenaire trouve" styleClass="nx-empty-title"/>
                            <Label text="Commencez par ajouter un nouveau partenaire" styleClass="nx-empty-subtitle"/>
                        </VBox>
                    </placeholder>
                </TableView>
            </VBox>

            <!-- Table Footer -->
            <HBox styleClass="nx-card-footer, nx-table-footer" alignment="CENTER" spacing="16">
                <Label fx:id="lblTableInfo" text="Affichage de 0 a 0 sur 0 entrees" styleClass="nx-table-info"/>
                <Region HBox.hgrow="ALWAYS"/>
                
                <!-- SMS Button -->
                <Button text="Envoyer SMS" styleClass="nx-btn, nx-btn-gold" onAction="#envoyerSMS">
                    <graphic>
                        <SVGPath content="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" styleClass="nx-btn-icon"/>
                    </graphic>
                </Button>

                <!-- Pagination -->
                <HBox styleClass="nx-pagination" spacing="4">
                    <Button text="&lt;&lt;" styleClass="nx-page-btn"/>
                    <Button text="&lt;" styleClass="nx-page-btn"/>
                    <Button text="1" styleClass="nx-page-btn, nx-page-btn-active"/>
                    <Button text="2" styleClass="nx-page-btn"/>
                    <Button text="&gt;" styleClass="nx-page-btn"/>
                    <Button text="&gt;&gt;" styleClass="nx-page-btn"/>
                </HBox>
            </HBox>
        </VBox>
    </HBox>
</VBox>

