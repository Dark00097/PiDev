<?xml version="1.0" encoding="UTF-8"?>

<?import java.lang.String?>
<?import javafx.collections.FXCollections?>
<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.shape.SVGPath?>

<VBox xmlns="http://javafx.com/javafx/17"
      xmlns:fx="http://javafx.com/fxml/1"
      fx:controller="com.nexora.bank.controllers.ReclamationController"
      stylesheets="@../css/Reclamation.css"
      styleClass="nx-entity-container" spacing="24">

    <!-- =================== STAT CARDS =================== -->
    <HBox spacing="24" styleClass="nx-stats-row">
        <VBox styleClass="nx-stat-card" HBox.hgrow="ALWAYS">
            <HBox alignment="CENTER_LEFT" spacing="16">
                <StackPane styleClass="nx-stat-card-icon, nx-stat-card-icon-teal">
                    <SVGPath content="M12 2l10 4v6c0 5.55-3.84 10.74-10 12-6.16-1.26-10-6.45-10-12V6l10-4z"/>
                </StackPane>
                <VBox spacing="4">
                    <!-- FIX 1 : fx:id harmonisé avec le contrôleur (lblNombreReclamations) -->
                    <Label fx:id="lblNombreReclamations" text="0" styleClass="nx-stat-card-value"/>
                    <Label text="Total Reclamations" styleClass="nx-stat-card-label"/>
                </VBox>
            </HBox>
        </VBox>

        <VBox styleClass="nx-stat-card" HBox.hgrow="ALWAYS">
            <HBox alignment="CENTER_LEFT" spacing="16">
                <StackPane styleClass="nx-stat-card-icon, nx-stat-card-icon-warning">
                    <SVGPath content="M12 8v4m0 4h.01M2.5 19h19L12 3 2.5 19z"/>
                </StackPane>
                <VBox spacing="4">
                    <Label fx:id="lblEnAttente" text="0" styleClass="nx-stat-card-value"/>
                    <Label text="En attente" styleClass="nx-stat-card-label"/>
                </VBox>
            </HBox>
        </VBox>

        <VBox styleClass="nx-stat-card" HBox.hgrow="ALWAYS">
            <HBox alignment="CENTER_LEFT" spacing="16">
                <StackPane styleClass="nx-stat-card-icon, nx-stat-card-icon-gold">
                    <SVGPath content="M20 6L9 17l-5-5"/>
                </StackPane>
                <VBox spacing="4">
                    <Label fx:id="lblResolues" text="0" styleClass="nx-stat-card-value"/>
                    <Label text="Résolues" styleClass="nx-stat-card-label"/>
                </VBox>
            </HBox>
        </VBox>
    </HBox>

    <!-- =================== FORMULAIRE & TABLE =================== -->
    <HBox spacing="24" VBox.vgrow="ALWAYS">

        <!-- ==== FORMULAIRE RECLAMATION ==== -->
        <VBox styleClass="nx-card" prefWidth="560" minWidth="560" spacing="0">
            <HBox styleClass="nx-card-header" alignment="CENTER_LEFT" spacing="12">
                <StackPane styleClass="nx-card-header-icon">
                    <SVGPath content="M12 2l10 4v6c0 5.55-3.84 10.74-10 12-6.16-1.26-10-6.45-10-12V6l10-4z"/>
                </StackPane>
                <VBox spacing="2">
                    <Label text="Réclamation" styleClass="nx-card-title"/>
                    <Label text="Gérer les réclamations clients" styleClass="nx-card-subtitle"/>
                </VBox>
            </HBox>

            <ScrollPane styleClass="nx-form-scroll" fitToWidth="true" VBox.vgrow="ALWAYS">
                <VBox styleClass="nx-card-body" spacing="16">

                    <VBox styleClass="nx-form-group" spacing="8">
                        <Label text="Transaction associée" styleClass="nx-label, nx-label-required"/>
                        <ComboBox fx:id="cmbTransaction" promptText="Sélectionner une transaction" styleClass="nx-select" maxWidth="Infinity"/>
                        <Label fx:id="lblTransactionError" styleClass="nx-error-label"/>
                    </VBox>

                    <VBox styleClass="nx-form-group" spacing="8">
                        <Label text="Date Réclamation" styleClass="nx-label, nx-label-required"/>
                        <HBox styleClass="nx-input-wrapper">
                            <SVGPath content="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2z" styleClass="nx-input-icon"/>
                            <DatePicker fx:id="dpDateReclamation" styleClass="nx-datepicker" HBox.hgrow="ALWAYS"/>
                        </HBox>
                        <Label fx:id="lblDateError" styleClass="nx-error-label"/>
                    </VBox>

                    <VBox styleClass="nx-form-group" spacing="8">
                        <Label text="Type Réclamation" styleClass="nx-label, nx-label-required"/>
                        <ComboBox fx:id="cmbTypeReclamation" promptText="Sélectionner un type" styleClass="nx-select" maxWidth="Infinity">
                            <items>
                                <FXCollections fx:factory="observableArrayList">
                                    <String fx:value="VIREMENT_NON_RECU"/>
                                    <String fx:value="ERREUR_MONTANT"/>
                                    <String fx:value="TRANSACTION_INCONNUE"/>
                                    <String fx:value="PROBLEME_CARTE"/>
                                    <String fx:value="AUTRE"/>
                                </FXCollections>
                            </items>
                        </ComboBox>
                        <Label fx:id="lblTypeError" styleClass="nx-error-label"/>
                    </VBox>

                    <VBox styleClass="nx-form-group" spacing="8">
                        <Label text="Description" styleClass="nx-label, nx-label-required"/>
                        <TextArea fx:id="txtDescription" promptText="Décrire la réclamation..." styleClass="nx-textarea" prefRowCount="3"/>
                        <Label fx:id="lblDescriptionError" styleClass="nx-error-label"/>
                    </VBox>

                    <VBox styleClass="nx-form-group" spacing="8">
                        <Label text="Statut" styleClass="nx-label, nx-label-required"/>
                        <ComboBox fx:id="cmbStatut" promptText="Sélectionner un statut" styleClass="nx-select" maxWidth="Infinity">
                            <items>
                                <FXCollections fx:factory="observableArrayList">
                                    <String fx:value="En attente"/>
                                    <String fx:value="En cours"/>
                                    <String fx:value="Résolue"/>
                                    <String fx:value="Rejetée"/>
                                </FXCollections>
                            </items>
                        </ComboBox>
                        <Label fx:id="lblStatutError" styleClass="nx-error-label"/>
                    </VBox>

                </VBox>
            </ScrollPane>

            <!-- FIX 2 : fx:id ajouté sur btnAnnuler et btnSupprimer pour correspondre aux @FXML du contrôleur -->
            <HBox styleClass="nx-card-footer" spacing="12" alignment="CENTER_RIGHT">
                <Button fx:id="btnAnnuler" text="Annuler" styleClass="nx-btn, nx-btn-outline" onAction="#handleAnnuler"/>
                <Button fx:id="btnSupprimer" text="Supprimer" styleClass="nx-btn, nx-btn-danger" onAction="#handleSupprimer"/>
                <Button fx:id="btnAjouter" text="Ajouter" styleClass="nx-btn, nx-btn-primary" onAction="#handleAjouter"/>
            </HBox>
        </VBox>

        <!-- ==== TABLE RECLAMATIONS ==== -->
        <VBox styleClass="nx-card" HBox.hgrow="ALWAYS" spacing="0">
            <HBox styleClass="nx-card-header" alignment="CENTER_LEFT" spacing="16">
                <VBox spacing="2" HBox.hgrow="ALWAYS">
                    <Label text="Liste des Réclamations" styleClass="nx-card-title"/>
                    <Label text="Suivi des dossiers clients" styleClass="nx-card-subtitle"/>
                </VBox>
                <HBox styleClass="nx-table-search" alignment="CENTER_LEFT" spacing="8">
                    <SVGPath content="M21 21l-6-6m2-5a7 7 0 1 1-14 0 7 7 0 0 1 14 0z" styleClass="nx-search-icon-sm"/>
                    <TextField fx:id="txtRecherche" promptText="Rechercher..." styleClass="nx-search-input-sm" prefWidth="200"/>
                </HBox>
                <MenuButton text="Trier" styleClass="nx-btn, nx-btn-outline-sm">
                    <items>
                        <MenuItem text="Par Date" onAction="#trierParDate"/>
                        <MenuItem text="Par Type" onAction="#trierParType"/>
                        <MenuItem text="Par Statut" onAction="#trierParStatut"/>
                    </items>
                </MenuButton>
                <Button text="Export PDF" styleClass="nx-btn, nx-btn-secondary-sm" onAction="#exporterPDF"/>
            </HBox>

            <VBox styleClass="nx-table-container" VBox.vgrow="ALWAYS">
                <TableView fx:id="tableReclamations" styleClass="nx-table" VBox.vgrow="ALWAYS">
                    <columns>
                        <TableColumn fx:id="colId" text="ID" prefWidth="80"/>
                        <TableColumn fx:id="colTransaction" text="Transaction" prefWidth="150"/>
                        <TableColumn fx:id="colDate" text="Date" prefWidth="100"/>
                        <TableColumn fx:id="colType" text="Type" prefWidth="150"/>
                        <TableColumn fx:id="colDescription" text="Description" prefWidth="200"/>
                        <TableColumn fx:id="colStatut" text="Statut" prefWidth="100"/>
                        <TableColumn fx:id="colActions" text="Actions" prefWidth="100"/>
                    </columns>
                </TableView>
            </VBox>

            <HBox styleClass="nx-card-footer, nx-table-footer" alignment="CENTER" spacing="16">
                <Label fx:id="lblTableInfo" text="Affichage de 0 entrées" styleClass="nx-table-info"/>
                <Region HBox.hgrow="ALWAYS"/>
                <Button text="Notifier client" styleClass="nx-btn, nx-btn-gold" onAction="#envoyerSMS"/>
            </HBox>
        </VBox>
    </HBox>
</VBox>
