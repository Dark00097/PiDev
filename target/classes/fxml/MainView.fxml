<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.image.*?>
<?import javafx.scene.shape.*?>
<?import javafx.scene.chart.*?>
<?import javafx.geometry.Insets?>
<?import javafx.scene.effect.*?>
<?import org.kordamp.ikonli.javafx.FontIcon?>

<BorderPane xmlns="http://javafx.com/javafx/17" 
            xmlns:fx="http://javafx.com/fxml/1" 
            fx:controller="com.nexora.bank.controllers.MainController" 
            stylesheets="@../css/MainView.css" 
            styleClass="root nx-app">

    <!-- SIDEBAR -->
    <left>
        <VBox fx:id="sidebar" styleClass="nx-sidebar" prefWidth="280">
            <!-- Animated Glow Effect Overlay -->
            <VBox styleClass="nx-sidebar-glow-overlay" mouseTransparent="true"/>
            
            <!-- Logo Section with Animation -->
            <HBox styleClass="nx-sidebar-header" alignment="CENTER_LEFT" spacing="12">
                <padding><Insets top="20" right="20" bottom="20" left="20"/></padding>
                <StackPane styleClass="nx-logo-container">
                    <Circle radius="24" styleClass="nx-logo-pulse"/>
                    <ImageView fitHeight="40" fitWidth="40" preserveRatio="true" styleClass="nx-logo-image">
                        <Image url="@../images/logo.png"/>
                    </ImageView>
                </StackPane>
                <VBox spacing="2">
                    <Label text="NEXORA" styleClass="nx-sidebar-logo-text"/>
                    <Label text="Banking System" styleClass="nx-sidebar-logo-subtitle"/>
                </VBox>
                <Region HBox.hgrow="ALWAYS"/>
                <Button fx:id="toggleSidebarBtn" styleClass="nx-sidebar-toggle" onAction="#toggleSidebar">
                    <graphic>
                        <FontIcon iconLiteral="fas-angle-left" styleClass="nx-icon"/>
                    </graphic>
                </Button>
            </HBox>
<!-- Navigation Menu -->
            <ScrollPane styleClass="nx-sidebar-scroll" fitToWidth="true" VBox.vgrow="ALWAYS">
                <VBox fx:id="sidebarNav" styleClass="nx-sidebar-nav" spacing="4">
                    <padding><Insets top="16" right="12" bottom="16" left="12"/></padding>

                    <Button fx:id="btnDashboard" styleClass="nx-sidebar-link, nx-sidebar-link-active" 
                            onAction="#showDashboard" maxWidth="Infinity" alignment="CENTER_LEFT">
                        <graphic>
                            <HBox alignment="CENTER_LEFT" spacing="12">
                                <StackPane styleClass="nx-sidebar-icon-wrapper">
                                    <FontIcon iconLiteral="fas-tachometer-alt" styleClass="nx-sidebar-icon"/>
                                </StackPane>
                                <Label text="Tableau de Bord" styleClass="nx-sidebar-text"/>
                            </HBox>
                        </graphic>
                    </Button>

                    <Button fx:id="btnGestionUser" styleClass="nx-sidebar-link" 
                            onAction="#showGestionUser" maxWidth="Infinity" alignment="CENTER_LEFT">
                        <graphic>
                            <HBox alignment="CENTER_LEFT" spacing="12">
                                <StackPane styleClass="nx-sidebar-icon-wrapper nx-icon-users">
                                    <FontIcon iconLiteral="fas-users" styleClass="nx-sidebar-icon"/>
                                </StackPane>
                                <Label text="Gestion Utilisateurs" styleClass="nx-sidebar-text"/>
                            </HBox>
                        </graphic>
                    </Button>

                    <Button fx:id="btnAdminAccount" styleClass="nx-sidebar-link"
                            onAction="#showAdminAccountManagement" maxWidth="Infinity" alignment="CENTER_LEFT">
                        <graphic>
                            <HBox alignment="CENTER_LEFT" spacing="12">
                                <StackPane styleClass="nx-sidebar-icon-wrapper nx-icon-users">
                                    <FontIcon iconLiteral="fas-user-shield" styleClass="nx-sidebar-icon"/>
                                </StackPane>
                                <Label text="Admin Account" styleClass="nx-sidebar-text"/>
                            </HBox>
                        </graphic>
                    </Button>

                    <Button fx:id="btnGestionCompte" styleClass="nx-sidebar-link" 
                            onAction="#showGestionCompte" maxWidth="Infinity" alignment="CENTER_LEFT">
                        <graphic>
                            <HBox alignment="CENTER_LEFT" spacing="12">
                                <StackPane styleClass="nx-sidebar-icon-wrapper nx-icon-bank">
                                    <FontIcon iconLiteral="fas-university" styleClass="nx-sidebar-icon"/>
                                </StackPane>
                                <Label text="Comptes Bancaires" styleClass="nx-sidebar-text"/>
                            </HBox>
                        </graphic>
                    </Button>

                    <Button fx:id="btnGestionTransaction" styleClass="nx-sidebar-link" 
                            onAction="#showGestionTransaction" maxWidth="Infinity" alignment="CENTER_LEFT">
                        <graphic>
                            <HBox alignment="CENTER_LEFT" spacing="12">
                                <StackPane styleClass="nx-sidebar-icon-wrapper nx-icon-exchange">
                                    <FontIcon iconLiteral="fas-exchange-alt" styleClass="nx-sidebar-icon"/>
                                </StackPane>
                                <Label text="Transactions" styleClass="nx-sidebar-text"/>
                            </HBox>
                        </graphic>
                    </Button>

                    <Button fx:id="btnGestionCredit" styleClass="nx-sidebar-link" 
                            onAction="#showGestionCredit" maxWidth="Infinity" alignment="CENTER_LEFT">
                        <graphic>
                            <HBox alignment="CENTER_LEFT" spacing="12">
                                <StackPane styleClass="nx-sidebar-icon-wrapper nx-icon-credit">
                                    <FontIcon iconLiteral="fas-credit-card" styleClass="nx-sidebar-icon"/>
                                </StackPane>
                                <Label text="Gestion Crédit" styleClass="nx-sidebar-text"/>
                            </HBox>
                        </graphic>
                    </Button>

                    <Button fx:id="btnGestionCashback" styleClass="nx-sidebar-link" 
                            onAction="#showGestionCashback" maxWidth="Infinity" alignment="CENTER_LEFT">
                        <graphic>
                            <HBox alignment="CENTER_LEFT" spacing="12">
                                <StackPane styleClass="nx-sidebar-icon-wrapper nx-icon-coins">
                                    <FontIcon iconLiteral="fas-coins" styleClass="nx-sidebar-icon"/>
                                </StackPane>
                                <Label text="Gestion Cashback" styleClass="nx-sidebar-text"/>
                            </HBox>
                        </graphic>
                    </Button>

                </VBox>
            </ScrollPane>

            <!-- User Profile Section with Enhanced Design -->
            <VBox styleClass="nx-sidebar-footer">

                <HBox styleClass="nx-sidebar-user" alignment="CENTER_LEFT" spacing="12">
                    <padding><Insets top="16" right="16" bottom="16" left="16"/></padding>
                    <StackPane styleClass="nx-user-avatar-container">
                        <Circle radius="22" styleClass="nx-avatar-ring"/>
                        <ImageView fitHeight="40" fitWidth="40" styleClass="nx-sidebar-avatar">
                            <Image url="@../images/logo.png"/>
                        </ImageView>
                        <Circle radius="6" styleClass="nx-user-status-badge" translateX="14" translateY="14"/>
                    </StackPane>
                    <VBox spacing="2" HBox.hgrow="ALWAYS">
                        <Label text="Admin User" styleClass="nx-sidebar-user-name"/>
                        <HBox spacing="6" alignment="CENTER_LEFT">
                            <FontIcon iconLiteral="fas-crown" styleClass="nx-role-icon"/>
                            <Label text="Administrateur" styleClass="nx-sidebar-user-role"/>
                        </HBox>
                    </VBox>
                    <Button styleClass="nx-logout-btn" onAction="#showDashboard">
                        <tooltip><Tooltip text="Accueil"/></tooltip>
                        <graphic>
                            <FontIcon iconLiteral="fas-home" styleClass="nx-logout-icon"/>
                        </graphic>
                    </Button>
                    <Button styleClass="nx-logout-btn" onAction="#handleLogout">
                        <tooltip><Tooltip text="Deconnexion"/></tooltip>
                        <graphic>
                            <FontIcon iconLiteral="fas-sign-out-alt" styleClass="nx-logout-icon"/>
                        </graphic>
                    </Button>
                </HBox>
            </VBox>
        </VBox>
    </left>

    <!-- MAIN CONTENT AREA -->
    <center>
        <VBox styleClass="nx-main-content">
            <!-- TOP BAR with Glassmorphism -->
            <HBox fx:id="topBar" styleClass="nx-topbar" alignment="CENTER" spacing="16">
                <padding><Insets top="16" right="24" bottom="16" left="24"/></padding>
                
                <!-- Breadcrumb Navigation -->
                <HBox styleClass="nx-breadcrumb" alignment="CENTER_LEFT" spacing="8">
                    <FontIcon iconLiteral="fas-home" styleClass="nx-breadcrumb-icon"/>
                    <Label text="/" styleClass="nx-breadcrumb-separator"/>
                    <Label text="Tableau de Bord" styleClass="nx-breadcrumb-current"/>
                </HBox>

                <Region HBox.hgrow="ALWAYS"/>
                
                <!-- Search Bar with Animation -->
                <HBox styleClass="nx-search-wrapper" alignment="CENTER_LEFT" maxWidth="400">
                    <FontIcon iconLiteral="fas-search" styleClass="nx-search-icon"/>
                    <TextField fx:id="searchField" promptText="Rechercher utilisateurs, comptes, transactions..." styleClass="nx-search-input" HBox.hgrow="ALWAYS"/>
                    <Label text="⌘K" styleClass="nx-search-shortcut"/>
                </HBox>

                <Region HBox.hgrow="ALWAYS"/>

                <!-- Action Buttons with Tooltips -->
                <HBox spacing="8" alignment="CENTER">
                    <!-- Theme Toggle -->
                    <Button styleClass="nx-topbar-action" onAction="#toggleTheme">
                        <tooltip><Tooltip text="Changer le thème" styleClass="nx-tooltip"/></tooltip>
                        <graphic>
                            <FontIcon iconLiteral="fas-moon" styleClass="nx-topbar-icon"/>
                        </graphic>
                    </Button>

                    <!-- Email Button with Counter -->
                    <StackPane>
                        <Button styleClass="nx-topbar-action" onAction="#openEmail">
                            <tooltip><Tooltip text="Messages" styleClass="nx-tooltip"/></tooltip>
                            <graphic>
                                <FontIcon iconLiteral="fas-envelope" styleClass="nx-topbar-icon"/>
                            </graphic>
                        </Button>
                        <Label text="3" styleClass="nx-topbar-badge" translateX="12" translateY="-12"/>
                    </StackPane>

                    <!-- History Button -->
                    <Button styleClass="nx-topbar-action" onAction="#openHistory">
                        <tooltip><Tooltip text="Historique" styleClass="nx-tooltip"/></tooltip>
                        <graphic>
                            <FontIcon iconLiteral="fas-history" styleClass="nx-topbar-icon"/>
                        </graphic>
                    </Button>

                    <!-- Notifications Button with Animated Badge -->
                    <StackPane>
                        <Button styleClass="nx-topbar-action, nx-topbar-action-badge" onAction="#openNotifications">
                            <tooltip><Tooltip text="Notifications" styleClass="nx-tooltip"/></tooltip>
                            <graphic>
                                <FontIcon iconLiteral="fas-bell" styleClass="nx-topbar-icon nx-icon-animated"/>
                            </graphic>
                        </Button>
                        <Label text="7" styleClass="nx-topbar-badge nx-badge-pulse" translateX="12" translateY="-12"/>
                    </StackPane>

                    <!-- Settings -->
                    <Button styleClass="nx-topbar-action" onAction="#openSettings">
                        <tooltip><Tooltip text="Paramètres" styleClass="nx-tooltip"/></tooltip>
                        <graphic>
                            <FontIcon iconLiteral="fas-cog" styleClass="nx-topbar-icon nx-icon-spin-hover"/>
                        </graphic>
                    </Button>

                    <Separator orientation="VERTICAL" styleClass="nx-topbar-divider"/>

                    <!-- User Profile Dropdown -->
                    <MenuButton styleClass="nx-topbar-user-menu">
                        <graphic>
                            <HBox styleClass="nx-topbar-user" alignment="CENTER" spacing="12">
                                <VBox alignment="CENTER_RIGHT">
                                    <Label text="Admin User" styleClass="nx-topbar-user-name"/>
                                    <HBox spacing="4" alignment="CENTER_RIGHT">
                                        <Circle radius="4" styleClass="nx-online-indicator"/>
                                        <Label text="En ligne" styleClass="nx-topbar-user-status"/>
                                    </HBox>
                                </VBox>
                                <StackPane styleClass="nx-topbar-avatar-container">
                                    <ImageView fitHeight="42" fitWidth="42" styleClass="nx-topbar-avatar">
                                        <Image url="@../images/logo.png"/>
                                    </ImageView>
                                </StackPane>
                                <FontIcon iconLiteral="fas-chevron-down" styleClass="nx-dropdown-icon"/>
                            </HBox>
                        </graphic>
                        <items>
                            <MenuItem text="Mon Profil" onAction="#showProfile">
                                <graphic><FontIcon iconLiteral="fas-user" styleClass="nx-menu-icon"/></graphic>
                            </MenuItem>
                            <MenuItem text="Paramètres" onAction="#openSettings">
                                <graphic><FontIcon iconLiteral="fas-cog" styleClass="nx-menu-icon"/></graphic>
                            </MenuItem>
                            <SeparatorMenuItem/>
                            <MenuItem text="Déconnexion" onAction="#handleLogout" styleClass="nx-menu-danger">
                                <graphic><FontIcon iconLiteral="fas-sign-out-alt" styleClass="nx-menu-icon-danger"/></graphic>
                            </MenuItem>
                        </items>
                    </MenuButton>
                </HBox>
            </HBox>

            <!-- CONTENT CONTAINER -->
            <ScrollPane fx:id="contentScrollPane" styleClass="nx-content-scroll" fitToWidth="true" fitToHeight="true" VBox.vgrow="ALWAYS">
                <StackPane fx:id="contentArea" styleClass="nx-content-area">
                    <padding><Insets top="24" right="24" bottom="24" left="24"/></padding>
                    
                    <!-- Default Dashboard Content -->
                    <VBox fx:id="dashboardContent" spacing="24">
                        <!-- Welcome Banner with Animation -->
                        <HBox styleClass="nx-welcome-banner" alignment="CENTER_LEFT" spacing="20">
                            <VBox spacing="8" HBox.hgrow="ALWAYS">
                                <HBox alignment="CENTER_LEFT" spacing="12">
                                    <Label text="Bonjour," styleClass="nx-welcome-greeting"/>
                                    <Label text="Admin User" styleClass="nx-welcome-name"/>
                                    <FontIcon iconLiteral="fas-hand-sparkles" styleClass="nx-welcome-wave"/>
                                </HBox>
                                <Label text="Bienvenue sur votre tableau de bord NEXORA Bank. Voici un aperçu de vos activités." styleClass="nx-welcome-subtitle"/>
                                <HBox spacing="12" styleClass="nx-welcome-actions">
                                    <Button text="Voir les alertes" styleClass="nx-btn nx-btn-glass">
                                        <graphic><FontIcon iconLiteral="fas-exclamation-triangle" styleClass="nx-btn-icon"/></graphic>
                                    </Button>
                                    <Button text="Générer un rapport" styleClass="nx-btn nx-btn-glass-outline">
                                        <graphic><FontIcon iconLiteral="fas-file-export" styleClass="nx-btn-icon"/></graphic>
                                    </Button>
                                </HBox>
                            </VBox>
                            <VBox alignment="CENTER" styleClass="nx-welcome-stats">
                                <Label text="Aujourd'hui" styleClass="nx-welcome-date-label"/>
                                <Label fx:id="currentDate" text="15 Janvier 2025" styleClass="nx-welcome-date"/>
                                <Label fx:id="currentTime" text="14:30:45" styleClass="nx-welcome-time"/>
                            </VBox>
                        </HBox>

                        <!-- Alert Banner (Conditional) -->
                        <HBox styleClass="nx-alert-banner nx-alert-warning" alignment="CENTER_LEFT" spacing="12">
                            <FontIcon iconLiteral="fas-exclamation-circle" styleClass="nx-alert-icon"/>
                            <VBox HBox.hgrow="ALWAYS" spacing="2">
                                <Label text="Attention requise" styleClass="nx-alert-title"/>
                                <Label text="8 demandes de crédit nécessitent une vérification urgente." styleClass="nx-alert-message"/>
                            </VBox>
                            <Button text="Voir les détails" styleClass="nx-btn nx-btn-sm nx-btn-warning"/>
                            <Button styleClass="nx-alert-close" onAction="#closeAlert">
                                <graphic><FontIcon iconLiteral="fas-times" styleClass="nx-close-icon"/></graphic>
                            </Button>
                        </HBox>

                        <!-- Quick Stats Row with Animations -->
                        <HBox spacing="20">
                            <!-- Stat Card 1 - Users -->
                            <VBox styleClass="nx-stat-card nx-stat-card-animated" HBox.hgrow="ALWAYS">
                                <HBox styleClass="nx-stat-card-header" alignment="CENTER_LEFT" spacing="16">
                                    <StackPane styleClass="nx-stat-card-icon nx-stat-card-icon-teal">
                                        <Circle radius="28" styleClass="nx-icon-bg-pulse"/>
                                        <FontIcon iconLiteral="fas-user-friends" styleClass="nx-stat-icon"/>
                                    </StackPane>
                                    <VBox HBox.hgrow="ALWAYS">
                                        <Label text="Total Utilisateurs" styleClass="nx-stat-card-label"/>
                                        <HBox alignment="CENTER_LEFT" spacing="8">
                                            <Label text="1,234" styleClass="nx-stat-card-value"/>
                                            <HBox styleClass="nx-stat-trend nx-trend-up" spacing="4">
                                                <FontIcon iconLiteral="fas-arrow-up" styleClass="nx-trend-icon"/>
                                                <Label text="+12%" styleClass="nx-trend-value"/>
                                            </HBox>
                                        </HBox>
                                    </VBox>
                                    <VBox alignment="CENTER_RIGHT">
                                        <FontIcon iconLiteral="fas-ellipsis-v" styleClass="nx-card-menu"/>
                                    </VBox>
                                </HBox>
                                <!-- Mini Chart -->
                                <HBox styleClass="nx-mini-chart" spacing="3" alignment="BOTTOM_CENTER">
                                    <VBox styleClass="nx-mini-bar" prefHeight="20" prefWidth="8"/>
                                    <VBox styleClass="nx-mini-bar" prefHeight="35" prefWidth="8"/>
                                    <VBox styleClass="nx-mini-bar" prefHeight="25" prefWidth="8"/>
                                    <VBox styleClass="nx-mini-bar" prefHeight="40" prefWidth="8"/>
                                    <VBox styleClass="nx-mini-bar" prefHeight="30" prefWidth="8"/>
                                    <VBox styleClass="nx-mini-bar" prefHeight="45" prefWidth="8"/>
                                    <VBox styleClass="nx-mini-bar nx-bar-current" prefHeight="50" prefWidth="8"/>
                                </HBox>
                                <HBox alignment="CENTER_LEFT" spacing="4">
                                    <Label text="vs mois dernier" styleClass="nx-stat-card-period"/>
                                    <Region HBox.hgrow="ALWAYS"/>
                                    <Label text="Voir détails →" styleClass="nx-stat-card-link"/>
                                </HBox>
                            </VBox>

                            <!-- Stat Card 2 - Accounts -->
                            <VBox styleClass="nx-stat-card nx-stat-card-animated" HBox.hgrow="ALWAYS">
                                <HBox styleClass="nx-stat-card-header" alignment="CENTER_LEFT" spacing="16">
                                    <StackPane styleClass="nx-stat-card-icon nx-stat-card-icon-blue">
                                        <Circle radius="28" styleClass="nx-icon-bg-pulse"/>
                                        <FontIcon iconLiteral="fas-university" styleClass="nx-stat-icon"/>
                                    </StackPane>
                                    <VBox HBox.hgrow="ALWAYS">
                                        <Label text="Comptes Actifs" styleClass="nx-stat-card-label"/>
                                        <HBox alignment="CENTER_LEFT" spacing="8">
                                            <Label text="856" styleClass="nx-stat-card-value"/>
                                            <HBox styleClass="nx-stat-trend nx-trend-up" spacing="4">
                                                <FontIcon iconLiteral="fas-arrow-up" styleClass="nx-trend-icon"/>
                                                <Label text="+8%" styleClass="nx-trend-value"/>
                                            </HBox>
                                        </HBox>
                                    </VBox>
                                    <VBox alignment="CENTER_RIGHT">
                                        <FontIcon iconLiteral="fas-ellipsis-v" styleClass="nx-card-menu"/>
                                    </VBox>
                                </HBox>
                                <!-- Progress Ring -->
                                <HBox alignment="CENTER" styleClass="nx-progress-container">
                                    <StackPane>
                                        <ProgressIndicator progress="0.75" styleClass="nx-circular-progress"/>
                                        <VBox alignment="CENTER" spacing="0">
                                            <Label text="75%" styleClass="nx-progress-value"/>
                                            <Label text="Objectif" styleClass="nx-progress-label"/>
                                        </VBox>
                                    </StackPane>
                                </HBox>
                                <HBox alignment="CENTER_LEFT" spacing="4">
                                    <Label text="vs mois dernier" styleClass="nx-stat-card-period"/>
                                    <Region HBox.hgrow="ALWAYS"/>
                                    <Label text="Voir détails →" styleClass="nx-stat-card-link"/>
                                </HBox>
                            </VBox>

                            <!-- Stat Card 3 - Deposits -->
                            <VBox styleClass="nx-stat-card nx-stat-card-animated nx-stat-card-highlight" HBox.hgrow="ALWAYS">
                                <HBox styleClass="nx-stat-card-header" alignment="CENTER_LEFT" spacing="16">
                                    <StackPane styleClass="nx-stat-card-icon nx-stat-card-icon-gold">
                                        <Circle radius="28" styleClass="nx-icon-bg-pulse nx-pulse-gold"/>
                                        <FontIcon iconLiteral="fas-piggy-bank" styleClass="nx-stat-icon"/>
                                    </StackPane>
                                    <VBox HBox.hgrow="ALWAYS">
                                        <Label text="Total Dépôts" styleClass="nx-stat-card-label"/>
                                        <HBox alignment="CENTER_LEFT" spacing="8">
                                            <Label text="2,450,000" styleClass="nx-stat-card-value"/>
                                            <Label text="DT" styleClass="nx-stat-card-currency"/>
                                        </HBox>
                                    </VBox>
                                    <VBox alignment="CENTER_RIGHT">
                                        <HBox styleClass="nx-stat-trend nx-trend-up" spacing="4">
                                            <FontIcon iconLiteral="fas-arrow-up" styleClass="nx-trend-icon"/>
                                            <Label text="+15%" styleClass="nx-trend-value"/>
                                        </HBox>
                                    </VBox>
                                </HBox>
                                <!-- Sparkline -->
                                <HBox styleClass="nx-sparkline-container" alignment="CENTER">
                                    <Polyline points="0,30,20,25,40,28,60,15,80,20,100,10,120,5" styleClass="nx-sparkline"/>
                                </HBox>
                                <HBox alignment="CENTER_LEFT" spacing="4">
                                    <Label text="vs mois dernier" styleClass="nx-stat-card-period"/>
                                    <Region HBox.hgrow="ALWAYS"/>
                                    <Label text="Voir détails →" styleClass="nx-stat-card-link"/>
                                </HBox>
                            </VBox>

                            <!-- Stat Card 4 - Transactions -->
                            <VBox styleClass="nx-stat-card nx-stat-card-animated" HBox.hgrow="ALWAYS">
                                <HBox styleClass="nx-stat-card-header" alignment="CENTER_LEFT" spacing="16">
                                    <StackPane styleClass="nx-stat-card-icon nx-stat-card-icon-purple">
                                        <Circle radius="28" styleClass="nx-icon-bg-pulse nx-pulse-purple"/>
                                        <FontIcon iconLiteral="fas-exchange-alt" styleClass="nx-stat-icon"/>
                                    </StackPane>
                                    <VBox HBox.hgrow="ALWAYS">
                                        <Label text="Transactions" styleClass="nx-stat-card-label"/>
                                        <HBox alignment="CENTER_LEFT" spacing="8">
                                            <Label text="3,421" styleClass="nx-stat-card-value"/>
                                            <HBox styleClass="nx-stat-trend nx-trend-down" spacing="4">
                                                <FontIcon iconLiteral="fas-arrow-down" styleClass="nx-trend-icon"/>
                                                <Label text="-3%" styleClass="nx-trend-value"/>
                                            </HBox>
                                        </HBox>
                                    </VBox>
                                    <VBox alignment="CENTER_RIGHT">
                                        <FontIcon iconLiteral="fas-ellipsis-v" styleClass="nx-card-menu"/>
                                    </VBox>
                                </HBox>
                                <!-- Activity Dots -->
                                <HBox styleClass="nx-activity-dots" spacing="4" alignment="CENTER">
                                    <Circle radius="4" styleClass="nx-dot nx-dot-active"/>
                                    <Circle radius="4" styleClass="nx-dot nx-dot-active"/>
                                    <Circle radius="4" styleClass="nx-dot nx-dot-active"/>
                                    <Circle radius="4" styleClass="nx-dot"/>
                                    <Circle radius="4" styleClass="nx-dot"/>
                                    <Circle radius="4" styleClass="nx-dot nx-dot-active"/>
                                    <Circle radius="4" styleClass="nx-dot nx-dot-active"/>
                                </HBox>
                                <HBox alignment="CENTER_LEFT" spacing="4">
                                    <Label text="vs mois dernier" styleClass="nx-stat-card-period"/>
                                    <Region HBox.hgrow="ALWAYS"/>
                                    <Label text="Voir détails →" styleClass="nx-stat-card-link"/>
                                </HBox>
                            </VBox>
                        </HBox>

                        <!-- Charts Section -->
                        <HBox spacing="24" styleClass="nx-dashboard-transactions-row">
                            <!-- Main Chart - Transactions Over Time -->
                            <VBox styleClass="nx-chart-card" HBox.hgrow="ALWAYS">
                                <HBox styleClass="nx-chart-header" alignment="CENTER_LEFT">
                                    <VBox spacing="4">
                                        <Label text="Aperçu des Transactions" styleClass="nx-chart-title"/>
                                        <Label text="Évolution mensuelle des transactions" styleClass="nx-chart-subtitle"/>
                                    </VBox>
                                    <Region HBox.hgrow="ALWAYS"/>
                                    <HBox styleClass="nx-chart-legend" spacing="16">
                                        <HBox alignment="CENTER_LEFT" spacing="6">
                                            <Circle radius="5" styleClass="nx-legend-dot nx-legend-income"/>
                                            <Label text="Entrées" styleClass="nx-legend-label"/>
                                        </HBox>
                                        <HBox alignment="CENTER_LEFT" spacing="6">
                                            <Circle radius="5" styleClass="nx-legend-dot nx-legend-expense"/>
                                            <Label text="Sorties" styleClass="nx-legend-label"/>
                                        </HBox>
                                    </HBox>
                                    <HBox styleClass="nx-chart-actions" spacing="8">
                                        <Button text="Semaine" styleClass="nx-chart-btn"/>
                                        <Button text="Mois" styleClass="nx-chart-btn nx-chart-btn-active"/>
                                        <Button text="Année" styleClass="nx-chart-btn"/>
                                    </HBox>
                                </HBox>
                                <AreaChart fx:id="transactionChart" styleClass="nx-area-chart" VBox.vgrow="ALWAYS" 
                                           legendVisible="false" animated="true" createSymbols="true">
                                    <xAxis>
                                        <CategoryAxis label="Mois" styleClass="nx-chart-axis"/>
                                    </xAxis>
                                    <yAxis>
                                        <NumberAxis label="Montant (DT)" styleClass="nx-chart-axis"/>
                                    </yAxis>
                                </AreaChart>
                            </VBox>

                            <!-- Side Charts -->
                            <VBox spacing="24" prefWidth="380">
                                <!-- Pie Chart - Account Distribution -->
                                <VBox styleClass="nx-chart-card">
                                    <HBox styleClass="nx-chart-header" alignment="CENTER_LEFT">
                                        <VBox spacing="4">
                                            <Label text="Types de Comptes" styleClass="nx-chart-title"/>
                                            <Label text="Répartition des comptes" styleClass="nx-chart-subtitle"/>
                                        </VBox>
                                        <Region HBox.hgrow="ALWAYS"/>
                                        <Button styleClass="nx-card-action">
                                            <graphic><FontIcon iconLiteral="fas-expand" styleClass="nx-action-icon"/></graphic>
                                        </Button>
                                    </HBox>
                                    <PieChart fx:id="accountPieChart" styleClass="nx-pie-chart" 
                                              legendVisible="false" animated="true" labelsVisible="false"/>
                                    <!-- Custom Legend -->
                                    <VBox styleClass="nx-pie-legend" spacing="8">
                                        <HBox alignment="CENTER_LEFT" spacing="12">
                                            <Circle radius="6" styleClass="nx-legend-dot" style="-fx-fill: #00B4A0;"/>
                                            <Label text="Épargne" styleClass="nx-legend-label" HBox.hgrow="ALWAYS"/>
                                            <Label text="45%" styleClass="nx-legend-value"/>
                                        </HBox>
                                        <HBox alignment="CENTER_LEFT" spacing="12">
                                            <Circle radius="6" styleClass="nx-legend-dot" style="-fx-fill: #0A2540;"/>
                                            <Label text="Courant" styleClass="nx-legend-label" HBox.hgrow="ALWAYS"/>
                                            <Label text="35%" styleClass="nx-legend-value"/>
                                        </HBox>
                                        <HBox alignment="CENTER_LEFT" spacing="12">
                                            <Circle radius="6" styleClass="nx-legend-dot" style="-fx-fill: #F4C430;"/>
                                            <Label text="Professionnel" styleClass="nx-legend-label" HBox.hgrow="ALWAYS"/>
                                            <Label text="20%" styleClass="nx-legend-value"/>
                                        </HBox>
                                    </VBox>
                                </VBox>

                                <!-- Bar Chart - Weekly Activity -->
                                <VBox styleClass="nx-chart-card">
                                    <HBox styleClass="nx-chart-header" alignment="CENTER_LEFT">
                                        <VBox spacing="4">
                                            <Label text="Activité Hebdomadaire" styleClass="nx-chart-title"/>
                                            <Label text="Transactions par jour" styleClass="nx-chart-subtitle"/>
                                        </VBox>
                                        <Region HBox.hgrow="ALWAYS"/>
                                        <Button styleClass="nx-card-action">
                                            <graphic><FontIcon iconLiteral="fas-sync-alt" styleClass="nx-action-icon"/></graphic>
                                        </Button>
                                    </HBox>
                                    <BarChart fx:id="weeklyBarChart" styleClass="nx-bar-chart" 
                                              legendVisible="false" animated="true" barGap="4" categoryGap="10">
                                        <xAxis>
                                            <CategoryAxis styleClass="nx-chart-axis"/>
                                        </xAxis>
                                        <yAxis>
                                            <NumberAxis styleClass="nx-chart-axis"/>
                                        </yAxis>
                                    </BarChart>
                                </VBox>
                            </VBox>
                        </HBox>

                        <!-- Quick Actions & Recent Activity Row -->
                        <HBox spacing="24">
                            <!-- Quick Actions -->
                            <VBox spacing="16" HBox.hgrow="ALWAYS">
                                <HBox alignment="CENTER_LEFT" spacing="12">
                                    <FontIcon iconLiteral="fas-bolt" styleClass="nx-section-icon"/>
                                    <Label text="Accès Rapide" styleClass="nx-section-title"/>
                                </HBox>
                                <HBox spacing="16">
                                    <VBox styleClass="nx-quick-action" alignment="CENTER" onMouseClicked="#showGestionCompte" HBox.hgrow="ALWAYS">
                                        <StackPane styleClass="nx-quick-action-icon">
                                            <Circle radius="32" styleClass="nx-quick-icon-bg"/>
                                            <FontIcon iconLiteral="fas-university" styleClass="nx-quick-icon"/>
                                        </StackPane>
                                        <Label text="Comptes Bancaires" styleClass="nx-quick-action-label"/>
                                        <Label text="856 actifs" styleClass="nx-quick-action-sublabel"/>
                                    </VBox>
                                    <VBox styleClass="nx-quick-action" alignment="CENTER" onMouseClicked="#showGestionTransaction" HBox.hgrow="ALWAYS">
                                        <StackPane styleClass="nx-quick-action-icon">
                                            <Circle radius="32" styleClass="nx-quick-icon-bg"/>
                                            <FontIcon iconLiteral="fas-exchange-alt" styleClass="nx-quick-icon"/>
                                        </StackPane>
                                        <Label text="Transactions" styleClass="nx-quick-action-label"/>
                                        <Label text="3,421 ce mois" styleClass="nx-quick-action-sublabel"/>
                                    </VBox>
                                    <VBox styleClass="nx-quick-action" alignment="CENTER" onMouseClicked="#showGestionCredit" HBox.hgrow="ALWAYS">
                                        <StackPane styleClass="nx-quick-action-icon">
                                            <Circle radius="32" styleClass="nx-quick-icon-bg"/>
                                            <FontIcon iconLiteral="fas-credit-card" styleClass="nx-quick-icon"/>
                                        </StackPane>
                                        <Label text="Crédits" styleClass="nx-quick-action-label"/>
                                        <Label text="142 demandes" styleClass="nx-quick-action-sublabel"/>
                                    </VBox>
                                    <VBox styleClass="nx-quick-action" alignment="CENTER" onMouseClicked="#showGestionCashback" HBox.hgrow="ALWAYS">
                                        <StackPane styleClass="nx-quick-action-icon">
                                            <Circle radius="32" styleClass="nx-quick-icon-bg"/>
                                            <FontIcon iconLiteral="fas-coins" styleClass="nx-quick-icon"/>
                                        </StackPane>
                                        <Label text="Cashback" styleClass="nx-quick-action-label"/>
                                        <Label text="45,230 DT" styleClass="nx-quick-action-sublabel"/>
                                    </VBox>
                                    <VBox styleClass="nx-quick-action nx-quick-action-add" alignment="CENTER" onMouseClicked="#addNewEntity" HBox.hgrow="ALWAYS">
                                        <StackPane styleClass="nx-quick-action-icon nx-icon-add">
                                            <FontIcon iconLiteral="fas-plus" styleClass="nx-quick-icon"/>
                                        </StackPane>
                                        <Label text="Ajouter" styleClass="nx-quick-action-label"/>
                                        <Label text="Nouveau" styleClass="nx-quick-action-sublabel"/>
                                    </VBox>
                                </HBox>
                            </VBox>
                        </HBox>

                        <!-- Recent Transactions & Pending Actions -->
                        <HBox spacing="24">
                            <!-- Recent Transactions Table -->
                            <VBox styleClass="nx-table-card nx-dashboard-main-table-card" HBox.hgrow="ALWAYS">
                                <HBox styleClass="nx-table-header" alignment="CENTER_LEFT">
                                    <VBox spacing="4">
                                        <Label text="Transactions Récentes" styleClass="nx-table-title"/>
                                        <Label text="Dernières activités en temps réel" styleClass="nx-table-subtitle"/>
                                    </VBox>
                                    <Region HBox.hgrow="ALWAYS"/>
                                    <Button text="Voir tout" styleClass="nx-btn nx-btn-outline nx-btn-sm">
                                        <graphic><FontIcon iconLiteral="fas-arrow-right" styleClass="nx-btn-icon"/></graphic>
                                    </Button>
                                </HBox>
                                <TableView fx:id="recentTransactionsTable" styleClass="nx-table nx-dashboard-recent-table" VBox.vgrow="ALWAYS">
                                    <columns>
                                        <TableColumn fx:id="colId" text="ID" prefWidth="80" styleClass="nx-table-col"/>
                                        <TableColumn fx:id="colClient" text="Client" prefWidth="180" styleClass="nx-table-col"/>
                                        <TableColumn fx:id="colType" text="Type" prefWidth="120" styleClass="nx-table-col"/>
                                        <TableColumn fx:id="colAmount" text="Montant" prefWidth="120" styleClass="nx-table-col"/>
                                        <TableColumn fx:id="colDate" text="Date" prefWidth="140" styleClass="nx-table-col"/>
                                        <TableColumn fx:id="colStatus" text="Statut" prefWidth="100" styleClass="nx-table-col"/>
                                    </columns>
                                    <placeholder>
                                        <VBox alignment="CENTER" spacing="12" styleClass="nx-table-empty">
                                            <FontIcon iconLiteral="fas-inbox" styleClass="nx-empty-icon"/>
                                            <Label text="Aucune transaction récente" styleClass="nx-empty-label"/>
                                        </VBox>
                                    </placeholder>
                                </TableView>
                            </VBox>

                            <!-- Pending Actions & Notifications -->
                            <VBox styleClass="nx-pending-card nx-dashboard-pending-card" prefWidth="380" spacing="16">
                                <HBox styleClass="nx-pending-header" alignment="CENTER_LEFT">
                                    <VBox spacing="4">
                                        <Label text="Actions en Attente" styleClass="nx-pending-title"/>
                                        <Label text="Éléments nécessitant votre attention" styleClass="nx-pending-subtitle"/>
                                    </VBox>
                                    <Region HBox.hgrow="ALWAYS"/>
                                    <Label text="15" styleClass="nx-pending-count"/>
                                </HBox>
                                
                                <ScrollPane styleClass="nx-pending-scroll nx-dashboard-pending-scroll" fitToWidth="true" VBox.vgrow="ALWAYS">
                                    <VBox styleClass="nx-pending-list" spacing="12">
                                        <!-- Pending Item 1 -->
                                        <HBox styleClass="nx-pending-item nx-pending-urgent" alignment="CENTER_LEFT" spacing="12">
                                            <StackPane styleClass="nx-pending-icon nx-pending-icon-credit">
                                                <FontIcon iconLiteral="fas-credit-card" styleClass="nx-pending-item-icon"/>
                                            </StackPane>
                                            <VBox spacing="2" HBox.hgrow="ALWAYS">
                                                <Label text="Demande de crédit #CR-2024" styleClass="nx-pending-item-title"/>
                                                <Label text="Mohamed Ben Ali - 50,000 DT" styleClass="nx-pending-item-desc"/>
                                                <Label text="Il y a 5 minutes" styleClass="nx-pending-item-time"/>
                                            </VBox>
                                            <Button styleClass="nx-pending-action">
                                                <graphic><FontIcon iconLiteral="fas-arrow-right" styleClass="nx-action-icon"/></graphic>
                                            </Button>
                                        </HBox>

                                        <!-- Pending Item 2 -->
                                        <HBox styleClass="nx-pending-item nx-pending-warning" alignment="CENTER_LEFT" spacing="12">
                                            <StackPane styleClass="nx-pending-icon nx-pending-icon-verify">
                                                <FontIcon iconLiteral="fas-user-check" styleClass="nx-pending-item-icon"/>
                                            </StackPane>
                                            <VBox spacing="2" HBox.hgrow="ALWAYS">
                                                <Label text="Vérification KYC requise" styleClass="nx-pending-item-title"/>
                                                <Label text="3 nouveaux utilisateurs" styleClass="nx-pending-item-desc"/>
                                                <Label text="Il y a 15 minutes" styleClass="nx-pending-item-time"/>
                                            </VBox>
                                            <Button styleClass="nx-pending-action">
                                                <graphic><FontIcon iconLiteral="fas-arrow-right" styleClass="nx-action-icon"/></graphic>
                                            </Button>
                                        </HBox>

                                        <!-- Pending Item 3 -->
                                        <HBox styleClass="nx-pending-item" alignment="CENTER_LEFT" spacing="12">
                                            <StackPane styleClass="nx-pending-icon nx-pending-icon-transfer">
                                                <FontIcon iconLiteral="fas-exchange-alt" styleClass="nx-pending-item-icon"/>
                                            </StackPane>
                                            <VBox spacing="2" HBox.hgrow="ALWAYS">
                                                <Label text="Virement international" styleClass="nx-pending-item-title"/>
                                                <Label text="Approbation nécessaire" styleClass="nx-pending-item-desc"/>
                                                <Label text="Il y a 30 minutes" styleClass="nx-pending-item-time"/>
                                            </VBox>
                                            <Button styleClass="nx-pending-action">
                                                <graphic><FontIcon iconLiteral="fas-arrow-right" styleClass="nx-action-icon"/></graphic>
                                            </Button>
                                        </HBox>

                                        <!-- Pending Item 4 -->
                                        <HBox styleClass="nx-pending-item nx-pending-success" alignment="CENTER_LEFT" spacing="12">
                                            <StackPane styleClass="nx-pending-icon nx-pending-icon-cashback">
                                                <FontIcon iconLiteral="fas-gift" styleClass="nx-pending-item-icon"/>
                                            </StackPane>
                                            <VBox spacing="2" HBox.hgrow="ALWAYS">
                                                <Label text="Cashback à distribuer" styleClass="nx-pending-item-title"/>
                                                <Label text="12 récompenses prêtes" styleClass="nx-pending-item-desc"/>
                                                <Label text="Il y a 1 heure" styleClass="nx-pending-item-time"/>
                                            </VBox>
                                            <Button styleClass="nx-pending-action">
                                                <graphic><FontIcon iconLiteral="fas-arrow-right" styleClass="nx-action-icon"/></graphic>
                                            </Button>
                                        </HBox>

                                        <!-- Pending Item 5 -->
                                        <HBox styleClass="nx-pending-item" alignment="CENTER_LEFT" spacing="12">
                                            <StackPane styleClass="nx-pending-icon nx-pending-icon-report">
                                                <FontIcon iconLiteral="fas-file-alt" styleClass="nx-pending-item-icon"/>
                                            </StackPane>
                                            <VBox spacing="2" HBox.hgrow="ALWAYS">
                                                <Label text="Rapport mensuel" styleClass="nx-pending-item-title"/>
                                                <Label text="Prêt pour révision" styleClass="nx-pending-item-desc"/>
                                                <Label text="Il y a 2 heures" styleClass="nx-pending-item-time"/>
                                            </VBox>
                                            <Button styleClass="nx-pending-action">
                                                <graphic><FontIcon iconLiteral="fas-arrow-right" styleClass="nx-action-icon"/></graphic>
                                            </Button>
                                        </HBox>
                                    </VBox>
                                </ScrollPane>

                                <Button text="Voir toutes les actions" styleClass="nx-btn nx-btn-outline" maxWidth="Infinity">
                                    <graphic><FontIcon iconLiteral="fas-list" styleClass="nx-btn-icon"/></graphic>
                                </Button>
                            </VBox>
                        </HBox>

                        <!-- Performance Goals Section -->
                        <VBox styleClass="nx-goals-card" spacing="20">
                            <HBox alignment="CENTER_LEFT" spacing="12">
                                <FontIcon iconLiteral="fas-bullseye" styleClass="nx-section-icon"/>
                                <Label text="Objectifs du Mois" styleClass="nx-section-title"/>
                                <Region HBox.hgrow="ALWAYS"/>
                                <Label text="Janvier 2025" styleClass="nx-goals-period"/>
                            </HBox>
                            <HBox spacing="24">
                                <!-- Goal 1 -->
                                <VBox styleClass="nx-goal-item" HBox.hgrow="ALWAYS" spacing="12">
                                    <HBox alignment="CENTER_LEFT">
                                        <Label text="Nouveaux Clients" styleClass="nx-goal-label"/>
                                        <Region HBox.hgrow="ALWAYS"/>
                                        <Label text="85/100" styleClass="nx-goal-value"/>
                                    </HBox>
                                    <ProgressBar progress="0.85" styleClass="nx-progress-bar nx-progress-teal"/>
                                    <Label text="85% atteint - 15 restants" styleClass="nx-goal-status"/>
                                </VBox>
                                <!-- Goal 2 -->
                                <VBox styleClass="nx-goal-item" HBox.hgrow="ALWAYS" spacing="12">
                                    <HBox alignment="CENTER_LEFT">
                                        <Label text="Volume Transactions" styleClass="nx-goal-label"/>
                                        <Region HBox.hgrow="ALWAYS"/>
                                        <Label text="2.1M/3M DT" styleClass="nx-goal-value"/>
                                    </HBox>
                                    <ProgressBar progress="0.70" styleClass="nx-progress-bar nx-progress-gold"/>
                                    <Label text="70% atteint - 900K DT restants" styleClass="nx-goal-status"/>
                                </VBox>
                                <!-- Goal 3 -->
                                <VBox styleClass="nx-goal-item" HBox.hgrow="ALWAYS" spacing="12">
                                    <HBox alignment="CENTER_LEFT">
                                        <Label text="Crédits Approuvés" styleClass="nx-goal-label"/>
                                        <Region HBox.hgrow="ALWAYS"/>
                                        <Label text="42/50" styleClass="nx-goal-value"/>
                                    </HBox>
                                    <ProgressBar progress="0.84" styleClass="nx-progress-bar nx-progress-blue"/>
                                    <Label text="84% atteint - 8 restants" styleClass="nx-goal-status"/>
                                </VBox>
                                <!-- Goal 4 -->
                                <VBox styleClass="nx-goal-item" HBox.hgrow="ALWAYS" spacing="12">
                                    <HBox alignment="CENTER_LEFT">
                                        <Label text="Satisfaction Client" styleClass="nx-goal-label"/>
                                        <Region HBox.hgrow="ALWAYS"/>
                                        <Label text="4.8/5.0" styleClass="nx-goal-value"/>
                                    </HBox>
                                    <ProgressBar progress="0.96" styleClass="nx-progress-bar nx-progress-success"/>
                                    <Label text="96% - Excellent!" styleClass="nx-goal-status nx-status-success"/>
                                </VBox>
                            </HBox>
                        </VBox>

                        <!-- Footer -->
                        <HBox styleClass="nx-dashboard-footer" alignment="CENTER" spacing="24">
                            <Label text="© 2025 NEXORA Bank. Tous droits réservés." styleClass="nx-footer-text"/>
                            <Region HBox.hgrow="ALWAYS"/>
                            <HBox spacing="16">
                                <Hyperlink text="Documentation" styleClass="nx-footer-link"/>
                                <Hyperlink text="Support" styleClass="nx-footer-link"/>
                                <Hyperlink text="Conditions" styleClass="nx-footer-link"/>
                            </HBox>
                        </HBox>
                    </VBox>
                </StackPane>
            </ScrollPane>
        </VBox>
    </center>
</BorderPane>
