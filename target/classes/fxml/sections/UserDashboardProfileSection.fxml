<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.CheckBox?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.control.PasswordField?>
<?import javafx.scene.control.ScrollPane?>
<?import javafx.scene.control.Separator?>
<?import javafx.scene.control.TextField?>
<?import javafx.scene.layout.ColumnConstraints?>
<?import javafx.scene.layout.FlowPane?>
<?import javafx.scene.layout.GridPane?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.layout.Priority?>
<?import javafx.scene.layout.Region?>
<?import javafx.scene.layout.StackPane?>
<?import javafx.scene.layout.VBox?>
<?import org.kordamp.ikonli.javafx.FontIcon?>

<VBox xmlns="http://javafx.com/javafx/17"
      xmlns:fx="http://javafx.com/fxml/1"
      fx:controller="com.nexora.bank.controllers.UserDashboardProfileSectionController"
      spacing="0"
      styleClass="profile-section"
      stylesheets="@../../css/sections/UserDashboardProfileSection.css"
      visible="false"
      managed="false">

    <VBox styleClass="section-header" spacing="16">
        <padding>
            <Insets top="28" right="32" bottom="24" left="32"/>
        </padding>
        <HBox alignment="CENTER_LEFT" spacing="16">
            <StackPane styleClass="section-icon-container">
                <FontIcon iconLiteral="fas-user-cog" styleClass="section-icon"/>
            </StackPane>
            <VBox spacing="4" HBox.hgrow="ALWAYS">
                <Label text="My Profile &amp; Security" styleClass="section-title"/>
                <Label text="Manage your account identity, password recovery and biometric access" styleClass="section-subtitle"/>
            </VBox>
            <Button styleClass="header-btn-secondary" onAction="#handleReloadProfile">
                <graphic>
                    <HBox spacing="8" alignment="CENTER">
                        <FontIcon iconLiteral="fas-sync-alt" styleClass="header-btn-icon"/>
                        <Label text="Refresh" styleClass="header-btn-label"/>
                    </HBox>
                </graphic>
            </Button>
        </HBox>
    </VBox>

    <VBox spacing="24" VBox.vgrow="ALWAYS">
        <padding>
            <Insets top="0" right="32" bottom="32" left="32"/>
        </padding>

        <FlowPane hgap="20" vgap="20" prefWrapLength="1200">
            <VBox styleClass="info-card info-card-main" prefWidth="520" spacing="16">
                <HBox alignment="CENTER_LEFT" spacing="12">
                    <StackPane styleClass="card-icon">
                        <FontIcon iconLiteral="fas-id-card" styleClass="card-icon-glyph"/>
                    </StackPane>
                    <VBox spacing="2">
                        <Label text="Account Identity" styleClass="card-title"/>
                        <Label text="Overview of your registered profile" styleClass="card-subtitle"/>
                    </VBox>
                </HBox>

                <HBox spacing="18" alignment="CENTER_LEFT">
                    <StackPane styleClass="avatar-wrap">
                        <FontIcon iconLiteral="fas-user" styleClass="avatar-icon"/>
                    </StackPane>
                    <VBox spacing="2" HBox.hgrow="ALWAYS">
                        <Label fx:id="lblProfileName" text="-" styleClass="profile-name"/>
                        <Label fx:id="lblProfileEmail" text="-" styleClass="profile-email"/>
                    </VBox>
                </HBox>

                <GridPane hgap="16" vgap="10">
                    <columnConstraints>
                        <ColumnConstraints percentWidth="34"/>
                        <ColumnConstraints percentWidth="66"/>
                    </columnConstraints>
                    <Label text="Account opened from" styleClass="meta-label" GridPane.rowIndex="0" GridPane.columnIndex="0"/>
                    <Label fx:id="lblAccountOpenedFrom" text="-" styleClass="meta-value" GridPane.rowIndex="0" GridPane.columnIndex="1"/>

                    <Label text="Last online time" styleClass="meta-label" GridPane.rowIndex="1" GridPane.columnIndex="0"/>
                    <Label fx:id="lblLastOnlineAt" text="-" styleClass="meta-value" GridPane.rowIndex="1" GridPane.columnIndex="1"/>

                    <Label text="Last online source" styleClass="meta-label" GridPane.rowIndex="2" GridPane.columnIndex="0"/>
                    <Label fx:id="lblLastOnlineFrom" text="-" styleClass="meta-value" GridPane.rowIndex="2" GridPane.columnIndex="1"/>
                </GridPane>
            </VBox>

            <VBox styleClass="info-card info-card-security" prefWidth="440" spacing="14">
                <HBox alignment="CENTER_LEFT" spacing="12">
                    <StackPane styleClass="card-icon card-icon-security">
                        <FontIcon iconLiteral="fas-fingerprint" styleClass="card-icon-glyph"/>
                    </StackPane>
                    <VBox spacing="2">
                        <Label text="Biometric Access" styleClass="card-title"/>
                        <Label text="Use face/fingerprint at login" styleClass="card-subtitle"/>
                    </VBox>
                </HBox>

                <CheckBox fx:id="chkEnableBiometric"
                          text="Enable biometric authentication on user login"
                          styleClass="bio-check"
                          onAction="#handleToggleBiometric"/>
                <Label fx:id="lblSecurityStatus" text=" " styleClass="status-label"/>
            </VBox>
        </FlowPane>

        <HBox spacing="24" VBox.vgrow="ALWAYS">
            <VBox styleClass="content-card" HBox.hgrow="ALWAYS" spacing="0">
                <HBox styleClass="card-header" spacing="12" alignment="CENTER_LEFT">
                    <StackPane styleClass="card-header-icon">
                        <FontIcon iconLiteral="fas-user-edit" styleClass="card-header-icon-glyph"/>
                    </StackPane>
                    <VBox spacing="2">
                        <Label text="Edit Profile" styleClass="card-header-title"/>
                        <Label text="Update name, email and phone" styleClass="card-header-subtitle"/>
                    </VBox>
                </HBox>

                <VBox styleClass="card-body" spacing="16">
                    <GridPane hgap="14" vgap="14">
                        <columnConstraints>
                            <ColumnConstraints percentWidth="50"/>
                            <ColumnConstraints percentWidth="50"/>
                        </columnConstraints>

                        <VBox spacing="6" GridPane.rowIndex="0" GridPane.columnIndex="0">
                            <Label text="Last name" styleClass="form-label"/>
                            <TextField fx:id="txtNom" promptText="Last name" styleClass="text-field"/>
                        </VBox>

                        <VBox spacing="6" GridPane.rowIndex="0" GridPane.columnIndex="1">
                            <Label text="First name" styleClass="form-label"/>
                            <TextField fx:id="txtPrenom" promptText="First name" styleClass="text-field"/>
                        </VBox>

                        <VBox spacing="6" GridPane.rowIndex="1" GridPane.columnIndex="0">
                            <Label text="Email" styleClass="form-label"/>
                            <TextField fx:id="txtEmail" promptText="name@company.com" styleClass="text-field"/>
                        </VBox>

                        <VBox spacing="6" GridPane.rowIndex="1" GridPane.columnIndex="1">
                            <Label text="Phone" styleClass="form-label"/>
                            <TextField fx:id="txtTelephone" promptText="+216 XX XXX XXX" styleClass="text-field"/>
                        </VBox>
                    </GridPane>

                    <HBox spacing="12" alignment="CENTER_RIGHT">
                        <Label fx:id="lblProfileStatus" text=" " styleClass="status-label" HBox.hgrow="ALWAYS"/>
                        <Button styleClass="btn-primary" onAction="#handleSaveProfile">
                            <graphic>
                                <HBox spacing="8" alignment="CENTER">
                                    <FontIcon iconLiteral="fas-save" styleClass="btn-icon-light"/>
                                    <Label text="Save Profile" styleClass="btn-label-light"/>
                                </HBox>
                            </graphic>
                        </Button>
                    </HBox>
                </VBox>
            </VBox>
        </HBox>

        <HBox spacing="24" VBox.vgrow="ALWAYS">
            <VBox styleClass="content-card" HBox.hgrow="ALWAYS" spacing="0">
                <HBox styleClass="card-header" spacing="12" alignment="CENTER_LEFT">
                    <StackPane styleClass="card-header-icon">
                        <FontIcon iconLiteral="fas-key" styleClass="card-header-icon-glyph"/>
                    </StackPane>
                    <VBox spacing="2">
                        <Label text="Change Password" styleClass="card-header-title"/>
                        <Label text="Update password using current password" styleClass="card-header-subtitle"/>
                    </VBox>
                </HBox>

                <VBox styleClass="card-body" spacing="14">
                    <VBox spacing="6">
                        <Label text="Current password" styleClass="form-label"/>
                        <PasswordField fx:id="txtCurrentPassword" promptText="Current password" styleClass="text-field"/>
                    </VBox>
                    <HBox spacing="12">
                        <VBox spacing="6" HBox.hgrow="ALWAYS">
                            <Label text="New password" styleClass="form-label"/>
                            <PasswordField fx:id="txtNewPassword" promptText="Strong password" styleClass="text-field"/>
                        </VBox>
                        <VBox spacing="6" HBox.hgrow="ALWAYS">
                            <Label text="Confirm new password" styleClass="form-label"/>
                            <PasswordField fx:id="txtConfirmPassword" promptText="Confirm password" styleClass="text-field"/>
                        </VBox>
                    </HBox>

                    <HBox spacing="12" alignment="CENTER_RIGHT">
                        <Label fx:id="lblPasswordStatus" text=" " styleClass="status-label" HBox.hgrow="ALWAYS"/>
                        <Button styleClass="btn-primary" onAction="#handleChangePassword">
                            <graphic>
                                <HBox spacing="8" alignment="CENTER">
                                    <FontIcon iconLiteral="fas-lock" styleClass="btn-icon-light"/>
                                    <Label text="Change Password" styleClass="btn-label-light"/>
                                </HBox>
                            </graphic>
                        </Button>
                    </HBox>
                </VBox>
            </VBox>

            <VBox styleClass="content-card" HBox.hgrow="ALWAYS" spacing="0">
                <HBox styleClass="card-header" spacing="12" alignment="CENTER_LEFT">
                    <StackPane styleClass="card-header-icon card-header-icon-warning">
                        <FontIcon iconLiteral="fas-shield-alt" styleClass="card-header-icon-glyph"/>
                    </StackPane>
                    <VBox spacing="2">
                        <Label text="Forgot Password (OTP)" styleClass="card-header-title"/>
                        <Label text="Reset password using email OTP verification" styleClass="card-header-subtitle"/>
                    </VBox>
                </HBox>

                <VBox styleClass="card-body" spacing="14">
                    <HBox spacing="12" alignment="CENTER_LEFT">
                        <Button styleClass="btn-secondary" onAction="#handleSendResetOtp">
                            <graphic>
                                <HBox spacing="8" alignment="CENTER">
                                    <FontIcon iconLiteral="fas-paper-plane" styleClass="btn-icon"/>
                                    <Label text="Send OTP" styleClass="btn-label"/>
                                </HBox>
                            </graphic>
                        </Button>
                        <Region HBox.hgrow="ALWAYS"/>
                        <Label text="OTP valid for 5 minutes" styleClass="helper-label"/>
                    </HBox>

                    <VBox spacing="6">
                        <Label text="OTP code" styleClass="form-label"/>
                        <TextField fx:id="txtResetOtp" promptText="Enter OTP code" styleClass="text-field"/>
                    </VBox>

                    <HBox spacing="12">
                        <VBox spacing="6" HBox.hgrow="ALWAYS">
                            <Label text="New password" styleClass="form-label"/>
                            <PasswordField fx:id="txtResetNewPassword" promptText="New password" styleClass="text-field"/>
                        </VBox>
                        <VBox spacing="6" HBox.hgrow="ALWAYS">
                            <Label text="Confirm new password" styleClass="form-label"/>
                            <PasswordField fx:id="txtResetConfirmPassword" promptText="Confirm new password" styleClass="text-field"/>
                        </VBox>
                    </HBox>

                    <HBox spacing="12" alignment="CENTER_RIGHT">
                        <Label fx:id="lblResetStatus" text=" " styleClass="status-label" HBox.hgrow="ALWAYS"/>
                        <Button styleClass="btn-accent" onAction="#handleResetPasswordWithOtp">
                            <graphic>
                                <HBox spacing="8" alignment="CENTER">
                                    <FontIcon iconLiteral="fas-check-circle" styleClass="btn-icon-light"/>
                                    <Label text="Reset Password" styleClass="btn-label-light"/>
                                </HBox>
                            </graphic>
                        </Button>
                    </HBox>
                </VBox>
            </VBox>
        </HBox>
    </VBox>
</VBox>
