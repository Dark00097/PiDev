<?xml version="1.0" encoding="UTF-8"?>
<?import javafx.collections.FXCollections?>
<?import javafx.geometry.Insets?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.ComboBox?>
<?import javafx.scene.control.DatePicker?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.control.ScrollPane?>
<?import javafx.scene.control.Separator?>
<?import javafx.scene.control.TableColumn?>
<?import javafx.scene.control.TableView?>
<?import javafx.scene.control.TextArea?>
<?import javafx.scene.control.TextField?>
<?import javafx.scene.layout.ColumnConstraints?>
<?import javafx.scene.layout.FlowPane?>
<?import javafx.scene.layout.GridPane?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.layout.Priority?>
<?import javafx.scene.layout.Region?>
<?import javafx.scene.layout.StackPane?>
<?import javafx.scene.layout.VBox?>
<?import org.kordamp.ikonli.javafx.FontIcon?>

<VBox xmlns="http://javafx.com/javafx/17"
      xmlns:fx="http://javafx.com/fxml/1"
      fx:controller="com.nexora.bank.controllers.UserDashboardCreditSectionController"
      fx:id="rootCreditSection"
      spacing="0"
      styleClass="credit-section"
      stylesheets="@../../css/sections/UserDashboardCreditSection.css"
      visible="false"
      managed="false">

    <VBox styleClass="section-header" spacing="16">
        <padding>
            <Insets top="28" right="32" bottom="24" left="32"/>
        </padding>
        <HBox alignment="CENTER_LEFT" spacing="16">
            <StackPane styleClass="section-icon-container">
                <FontIcon iconLiteral="fas-hand-holding-usd" styleClass="section-icon"/>
            </StackPane>
            <VBox spacing="4" HBox.hgrow="ALWAYS">
                <Label text="Services de credit" styleClass="section-title"/>
                <Label text="Demander des prets, gerer les credits et suivre les remboursements" styleClass="section-subtitle"/>
                <Label fx:id="lblUserCreditInfo" text="Utilisateur: -" styleClass="section-subtitle"/>
            </VBox>
            <HBox spacing="10" alignment="CENTER_RIGHT">
                <Button styleClass="header-btn-secondary" onAction="#viewPaymentSchedule">
                    <graphic>
                        <HBox spacing="8" alignment="CENTER">
                            <FontIcon iconLiteral="fas-calendar-alt" styleClass="header-btn-icon"/>
                            <Label text="Echeancier" styleClass="header-btn-label"/>
                        </HBox>
                    </graphic>
                </Button>
                <Button styleClass="header-btn-primary" onAction="#newCreditApplication">
                    <graphic>
                        <HBox spacing="8" alignment="CENTER">
                            <FontIcon iconLiteral="fas-plus" styleClass="header-btn-icon-accent"/>
                            <Label text="Demander un credit" styleClass="header-btn-label-dark"/>
                        </HBox>
                    </graphic>
                </Button>
            </HBox>
        </HBox>
    </VBox>

    <HBox styleClass="kpi-container" spacing="20">
        <padding>
            <Insets top="0" right="32" bottom="24" left="32"/>
        </padding>
        <VBox styleClass="kpi-card" HBox.hgrow="ALWAYS" spacing="8">
            <Label text="PRETS ACTIFS" styleClass="kpi-title"/>
            <Label text="CRUD utilisateur actif" styleClass="kpi-description"/>
        </VBox>
        <VBox styleClass="kpi-card" HBox.hgrow="ALWAYS" spacing="8">
            <Label text="GARANTIES" styleClass="kpi-title"/>
            <Label text="Formulaire + table integres" styleClass="kpi-description"/>
        </VBox>
    </HBox>

    <HBox spacing="24" VBox.vgrow="ALWAYS">
        <padding>
            <Insets top="0" right="32" bottom="32" left="32"/>
        </padding>

        <VBox styleClass="content-card" prefWidth="560" spacing="0">
            <HBox styleClass="card-header" spacing="14" alignment="CENTER_LEFT">
                <StackPane styleClass="card-header-icon">
                    <FontIcon iconLiteral="fas-file-signature" styleClass="card-header-icon-glyph"/>
                </StackPane>
                <VBox spacing="2">
                    <Label text="Demande de credit" styleClass="card-header-title"/>
                    <Label text="Formulaire CRUD Credit" styleClass="card-header-subtitle"/>
                </VBox>
            </HBox>

            <ScrollPane styleClass="form-scroll" fitToWidth="true" VBox.vgrow="ALWAYS">
                <VBox styleClass="card-body" spacing="20">
                    <VBox spacing="12">
                        <Label text="Selectionner le type de pret" styleClass="form-section-label"/>
                        <FlowPane styleClass="loan-type-grid" hgap="12" vgap="12">
                            <VBox styleClass="loan-type-card loan-type-selected" alignment="CENTER" spacing="8" onMouseClicked="#selectLoanType">
                                <StackPane styleClass="loan-type-icon-wrapper">
                                    <FontIcon iconLiteral="fas-home" styleClass="loan-type-icon"/>
                                </StackPane>
                                <Label text="Hypotheque" styleClass="loan-type-label"/>
                            </VBox>
                            <VBox styleClass="loan-type-card" alignment="CENTER" spacing="8" onMouseClicked="#selectLoanType">
                                <StackPane styleClass="loan-type-icon-wrapper">
                                    <FontIcon iconLiteral="fas-car" styleClass="loan-type-icon"/>
                                </StackPane>
                                <Label text="Pret auto" styleClass="loan-type-label"/>
                            </VBox>
                            <VBox styleClass="loan-type-card" alignment="CENTER" spacing="8" onMouseClicked="#selectLoanType">
                                <StackPane styleClass="loan-type-icon-wrapper">
                                    <FontIcon iconLiteral="fas-user" styleClass="loan-type-icon"/>
                                </StackPane>
                                <Label text="Personnel" styleClass="loan-type-label"/>
                            </VBox>
                            <VBox styleClass="loan-type-card" alignment="CENTER" spacing="8" onMouseClicked="#selectLoanType">
                                <StackPane styleClass="loan-type-icon-wrapper">
                                    <FontIcon iconLiteral="fas-briefcase" styleClass="loan-type-icon"/>
                                </StackPane>
                                <Label text="Professionnel" styleClass="loan-type-label"/>
                            </VBox>
                        </FlowPane>
                    </VBox>

                    <Separator styleClass="form-separator"/>

                    <GridPane styleClass="form-grid" hgap="16" vgap="14">
                        <columnConstraints>
                            <ColumnConstraints percentWidth="50"/>
                            <ColumnConstraints percentWidth="50"/>
                        </columnConstraints>

                        <VBox spacing="8" GridPane.rowIndex="0" GridPane.columnIndex="0">
                            <Label text="Compte" styleClass="form-label"/>
                            <ComboBox fx:id="cmbCompte" promptText="Choisir compte" styleClass="combo-box" maxWidth="Infinity"/>
                        </VBox>

                        <VBox spacing="8" GridPane.rowIndex="0" GridPane.columnIndex="1">
                            <Label text="Duree (mois)" styleClass="form-label"/>
                            <ComboBox fx:id="cbDuree" promptText="Selectionner la duree" styleClass="combo-box" maxWidth="Infinity"/>
                        </VBox>

                        <VBox spacing="8" GridPane.rowIndex="1" GridPane.columnIndex="0">
                            <Label text="Montant demande" styleClass="form-label"/>
                            <TextField fx:id="txtRequestedAmount" promptText="0.00" styleClass="text-field"/>
                        </VBox>

                        <VBox spacing="8" GridPane.rowIndex="1" GridPane.columnIndex="1">
                            <Label text="Montant accorde" styleClass="form-label"/>
                            <TextField fx:id="txtApprovedAmount" promptText="0.00" styleClass="text-field"/>
                        </VBox>

                        <VBox spacing="8" GridPane.rowIndex="2" GridPane.columnIndex="0">
                            <Label text="Taux d interet (TAEG)" styleClass="form-label"/>
                            <TextField fx:id="txtInterestRate" text="3.5" styleClass="text-field"/>
                        </VBox>

                        <VBox spacing="8" GridPane.rowIndex="2" GridPane.columnIndex="1">
                            <Label text="Mensualite estimee" styleClass="form-label"/>
                            <TextField fx:id="txtMonthlyPayment" promptText="0.00" styleClass="text-field"/>
                        </VBox>

                        <VBox spacing="8" GridPane.rowIndex="3" GridPane.columnIndex="0">
                            <Label text="Montant restant" styleClass="form-label"/>
                            <TextField fx:id="txtRemainingAmount" promptText="0.00" styleClass="text-field"/>
                        </VBox>

                        <VBox spacing="8" GridPane.rowIndex="3" GridPane.columnIndex="1">
                            <Label text="Date demande" styleClass="form-label"/>
                            <DatePicker fx:id="dpCreditDate" styleClass="date-picker" maxWidth="Infinity"/>
                        </VBox>

                        <VBox spacing="8" GridPane.rowIndex="4" GridPane.columnIndex="0" GridPane.columnSpan="2">
                            <Label text="Objet du pret" styleClass="form-label"/>
                            <ComboBox fx:id="cbPurpose" promptText="Selectionner le motif" styleClass="combo-box" maxWidth="Infinity"/>
                        </VBox>

                        <VBox spacing="8" GridPane.rowIndex="5" GridPane.columnIndex="0" GridPane.columnSpan="2">
                            <Label text="Informations complementaires" styleClass="form-label"/>
                            <TextArea fx:id="txtNotes" promptText="Notes..." prefRowCount="2" styleClass="text-area"/>
                        </VBox>
                    </GridPane>

                    <HBox spacing="10" alignment="CENTER_RIGHT" styleClass="form-actions">
                        <Button text="Vider" styleClass="btn-outline" onAction="#clearForm"/>
                        <Button text="Enregistrer brouillon" styleClass="btn-secondary" onAction="#saveAsDraft"/>
                        <Button fx:id="btnDeleteCredit" text="Supprimer" styleClass="btn-danger" onAction="#deleteSelectedCredit"/>
                        <Button fx:id="btnSubmitCredit" text="Soumettre la demande" styleClass="btn-primary" onAction="#submitApplication"/>
                    </HBox>
                </VBox>
            </ScrollPane>
        </VBox>

        <VBox styleClass="content-card" HBox.hgrow="ALWAYS" spacing="0">
            <HBox styleClass="card-header" spacing="14" alignment="CENTER_LEFT">
                <StackPane styleClass="card-header-icon">
                    <FontIcon iconLiteral="fas-credit-card" styleClass="card-header-icon-glyph"/>
                </StackPane>
                <VBox spacing="2">
                    <Label text="Credits actifs" styleClass="card-header-title"/>
                    <Label text="Table CRUD utilisateur" styleClass="card-header-subtitle"/>
                </VBox>
                <Region HBox.hgrow="ALWAYS"/>
                <Button text="Ajouter garantie" styleClass="credit-action-btn" onAction="#openGarantiePage"/>
            </HBox>

            <VBox styleClass="card-body" spacing="14">
                <TableView fx:id="tblCredits" prefHeight="230">
                    <columns>
                        <TableColumn fx:id="colCreditId" text="ID" prefWidth="70"/>
                        <TableColumn fx:id="colCreditCompte" text="Compte" prefWidth="90"/>
                        <TableColumn fx:id="colCreditType" text="Type" prefWidth="170"/>
                        <TableColumn fx:id="colCreditAmount" text="Montant" prefWidth="130"/>
                        <TableColumn fx:id="colCreditStatus" text="Statut" prefWidth="120"/>
                        <TableColumn fx:id="colCreditDate" text="Date" prefWidth="120"/>
                    </columns>
                </TableView>
            </VBox>

            <VBox fx:id="garantieFormContainer" styleClass="guarantee-form-container" spacing="0" visible="false" managed="false">
                <Separator styleClass="section-divider"/>
                <HBox styleClass="guarantee-form-header" spacing="12" alignment="CENTER_LEFT">
                    <StackPane styleClass="guarantee-form-icon">
                        <FontIcon iconLiteral="fas-shield-alt" styleClass="guarantee-form-icon-glyph"/>
                    </StackPane>
                    <VBox spacing="2" HBox.hgrow="ALWAYS">
                        <Label text="Ajouter / Modifier garantie" styleClass="guarantee-form-title"/>
                        <Label text="Formulaire base sur GarantieCredit.java" styleClass="guarantee-form-subtitle"/>
                    </VBox>
                    <Button styleClass="btn-icon-close" onAction="#hideGarantieForm">
                        <graphic><FontIcon iconLiteral="fas-times" styleClass="close-icon"/></graphic>
                    </Button>
                </HBox>

                <VBox styleClass="guarantee-form-body" spacing="14">
                    <GridPane hgap="16" vgap="12">
                        <columnConstraints>
                            <ColumnConstraints percentWidth="50"/>
                            <ColumnConstraints percentWidth="50"/>
                        </columnConstraints>

                        <VBox spacing="6" GridPane.rowIndex="0" GridPane.columnIndex="0">
                            <Label text="ID Credit" styleClass="form-label"/>
                            <ComboBox fx:id="cbGarantieCreditId" promptText="Credit" styleClass="combo-box" maxWidth="Infinity"/>
                        </VBox>
                        <VBox spacing="6" GridPane.rowIndex="0" GridPane.columnIndex="1">
                            <Label text="Type garantie" styleClass="form-label"/>
                            <ComboBox fx:id="cbGarantieType" promptText="Type" styleClass="combo-box" maxWidth="Infinity"/>
                        </VBox>
                        <VBox spacing="6" GridPane.rowIndex="1" GridPane.columnIndex="0">
                            <Label text="Valeur estimee" styleClass="form-label"/>
                            <TextField fx:id="txtGarantieEstimatedValue" promptText="0.00" styleClass="text-field"/>
                        </VBox>
                        <VBox spacing="6" GridPane.rowIndex="1" GridPane.columnIndex="1">
                            <Label text="Valeur retenue" styleClass="form-label"/>
                            <TextField fx:id="txtGarantieRetainedValue" promptText="0.00" styleClass="text-field"/>
                        </VBox>
                        <VBox spacing="6" GridPane.rowIndex="2" GridPane.columnIndex="0">
                            <Label text="Adresse bien" styleClass="form-label"/>
                            <TextField fx:id="txtGarantieAddress" promptText="Adresse" styleClass="text-field"/>
                        </VBox>
                        <VBox spacing="6" GridPane.rowIndex="2" GridPane.columnIndex="1">
                            <Label text="Nom garant" styleClass="form-label"/>
                            <TextField fx:id="txtGarantieNomGarant" promptText="Nom" styleClass="text-field"/>
                        </VBox>
                        <VBox spacing="6" GridPane.rowIndex="3" GridPane.columnIndex="0">
                            <Label text="Date evaluation" styleClass="form-label"/>
                            <DatePicker fx:id="dpGarantieDateEvaluation" styleClass="date-picker" maxWidth="Infinity"/>
                        </VBox>
                        <VBox spacing="6" GridPane.rowIndex="3" GridPane.columnIndex="1">
                            <Label text="Document justificatif" styleClass="form-label"/>
                            <TextField fx:id="txtGarantieDocument" promptText="Document" styleClass="text-field"/>
                        </VBox>
                        <VBox spacing="6" GridPane.rowIndex="4" GridPane.columnIndex="0" GridPane.columnSpan="2">
                            <Label text="Description" styleClass="form-label"/>
                            <TextArea fx:id="txtGarantieDescription" prefRowCount="2" styleClass="text-area"/>
                        </VBox>
                    </GridPane>
                    <HBox spacing="10" alignment="CENTER_RIGHT">
                        <Button text="Vider" styleClass="btn-outline" onAction="#clearGarantie"/>
                        <Button fx:id="btnDeleteGarantie" text="Supprimer" styleClass="btn-danger" onAction="#deleteSelectedGarantie"/>
                        <Button fx:id="btnSubmitGarantie" text="Soumettre la garantie" styleClass="btn-primary" onAction="#submitGuarantee"/>
                    </HBox>
                </VBox>
            </VBox>

            <VBox fx:id="garantiesDisplayContainer" styleClass="guarantees-list-container" spacing="0">
                <Separator styleClass="section-divider"/>
                <HBox styleClass="guarantees-list-header" spacing="12" alignment="CENTER_LEFT">
                    <StackPane styleClass="guarantees-list-icon">
                        <FontIcon iconLiteral="fas-list-alt" styleClass="guarantees-list-icon-glyph"/>
                    </StackPane>
                    <VBox spacing="2" HBox.hgrow="ALWAYS">
                        <Label text="Garanties de credit" styleClass="guarantees-list-title"/>
                        <Label text="Table garanties (CRUD)" styleClass="guarantees-list-subtitle"/>
                    </VBox>
                    <Button styleClass="btn-outline-small" onAction="#hideGaranties">
                        <graphic><Label text="Close"/></graphic>
                    </Button>
                </HBox>
                <VBox styleClass="guarantees-list-body" spacing="10">
                    <TableView fx:id="tblGaranties" prefHeight="210">
                        <columns>
                            <TableColumn fx:id="colGarantieId" text="ID" prefWidth="70"/>
                            <TableColumn fx:id="colGarantieCreditId" text="ID Credit" prefWidth="90"/>
                            <TableColumn fx:id="colGarantieType" text="Type" prefWidth="170"/>
                            <TableColumn fx:id="colGarantieValue" text="Valeur" prefWidth="130"/>
                            <TableColumn fx:id="colGarantieStatus" text="Statut" prefWidth="110"/>
                            <TableColumn fx:id="colGarantieDate" text="Date" prefWidth="120"/>
                        </columns>
                    </TableView>
                </VBox>
            </VBox>
        </VBox>
    </HBox>
</VBox>
