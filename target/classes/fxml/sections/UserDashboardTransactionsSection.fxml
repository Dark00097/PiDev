<?xml version="1.0" encoding="UTF-8"?>
<?import java.lang.String?>
<?import javafx.collections.FXCollections?>
<?import javafx.geometry.Insets?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.ComboBox?>
<?import javafx.scene.control.DatePicker?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.control.ScrollPane?>
<?import javafx.scene.control.Separator?>
<?import javafx.scene.control.TextArea?>
<?import javafx.scene.control.TextField?>
<?import javafx.scene.layout.ColumnConstraints?>
<?import javafx.scene.layout.GridPane?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.layout.Region?>
<?import javafx.scene.layout.StackPane?>
<?import javafx.scene.layout.VBox?>
<?import org.kordamp.ikonli.javafx.FontIcon?>

<VBox xmlns="http://javafx.com/javafx/17"
      xmlns:fx="http://javafx.com/fxml/1"
      fx:controller="com.nexora.bank.controllers.UserDashboardTransactionsSectionController"
      spacing="0"
      styleClass="transactions-section"
      stylesheets="@../../css/sections/UserDashboardTransactionsSection.css"
      visible="false"
      managed="false">

    <!-- ═══════════════════════════════ HEADER ═══════════════════════════════ -->
    <VBox styleClass="section-header" spacing="16">
        <padding><Insets top="28" right="32" bottom="24" left="32"/></padding>
        <HBox alignment="CENTER_LEFT" spacing="16">
            <StackPane styleClass="section-icon-container">
                <FontIcon iconLiteral="fas-exchange-alt" styleClass="section-icon"/>
            </StackPane>
            <VBox spacing="4" HBox.hgrow="ALWAYS">
                <Label text="Gestion des transactions" styleClass="section-title"/>
                <Label text="Voir, gérer et suivre toutes vos transactions financières" styleClass="section-subtitle"/>
            </VBox>
            <HBox spacing="10" alignment="CENTER_RIGHT">
                <VBox alignment="CENTER" spacing="2">
                    <Label text="Total" styleClass="kpi-title"/>
                    <Label fx:id="lblTotalTransactions" text="0" styleClass="kpi-value"/>
                </VBox>
                <Separator orientation="VERTICAL"/>
                <Button styleClass="header-btn-secondary" onAction="#exportTransactions">
                    <graphic><HBox spacing="8" alignment="CENTER">
                        <FontIcon iconLiteral="fas-download" styleClass="header-btn-icon"/>
                        <Label text="Export PDF" styleClass="header-btn-label"/>
                    </HBox></graphic>
                </Button>
                <Button styleClass="header-btn-secondary" onAction="#envoyerSMS">
                    <graphic><HBox spacing="8" alignment="CENTER">
                        <FontIcon iconLiteral="fas-sms" styleClass="header-btn-icon"/>
                        <Label text="SMS" styleClass="header-btn-label"/>
                    </HBox></graphic>
                </Button>
                <Button styleClass="header-btn-primary" onAction="#newTransaction">
                    <graphic><HBox spacing="8" alignment="CENTER">
                        <FontIcon iconLiteral="fas-plus" styleClass="header-btn-icon-accent"/>
                        <Label text="Nouvelle transaction" styleClass="header-btn-label-dark"/>
                    </HBox></graphic>
                </Button>
            </HBox>
        </HBox>
    </VBox>

    <!-- ═══════════════════════════════ KPI ══════════════════════════════════ -->
    <HBox styleClass="kpi-container" spacing="20">
        <padding><Insets top="0" right="32" bottom="24" left="32"/></padding>
        <VBox styleClass="kpi-card" HBox.hgrow="ALWAYS" spacing="14">
            <HBox spacing="12" alignment="CENTER_LEFT">
                <StackPane styleClass="kpi-icon-wrapper kpi-icon-success">
                    <FontIcon iconLiteral="fas-arrow-up" styleClass="kpi-icon"/>
                </StackPane>
                <VBox spacing="2">
                    <Label text="REVENUS" styleClass="kpi-title"/>
                    <Label text="30 derniers jours" styleClass="kpi-description"/>
                </VBox>
            </HBox>
            <HBox alignment="CENTER_LEFT" spacing="8">
                <Label text="+$12,450.00" styleClass="kpi-value kpi-value-success"/>
            </HBox>
        </VBox>
        <VBox styleClass="kpi-card" HBox.hgrow="ALWAYS" spacing="14">
            <HBox spacing="12" alignment="CENTER_LEFT">
                <StackPane styleClass="kpi-icon-wrapper kpi-icon-danger">
                    <FontIcon iconLiteral="fas-arrow-down" styleClass="kpi-icon"/>
                </StackPane>
                <VBox spacing="2">
                    <Label text="DÉPENSES" styleClass="kpi-title"/>
                    <Label text="30 derniers jours" styleClass="kpi-description"/>
                </VBox>
            </HBox>
            <HBox alignment="CENTER_LEFT" spacing="8">
                <Label text="-$8,320.00" styleClass="kpi-value kpi-value-danger"/>
            </HBox>
        </VBox>
        <VBox styleClass="kpi-card" HBox.hgrow="ALWAYS" spacing="14">
            <HBox spacing="12" alignment="CENTER_LEFT">
                <StackPane styleClass="kpi-icon-wrapper kpi-icon-primary">
                    <FontIcon iconLiteral="fas-balance-scale" styleClass="kpi-icon"/>
                </StackPane>
                <VBox spacing="2">
                    <Label text="SOLDE NET" styleClass="kpi-title"/>
                    <Label text="Ce mois" styleClass="kpi-description"/>
                </VBox>
            </HBox>
            <Label text="+$4,130.00" styleClass="kpi-value kpi-value-success"/>
        </VBox>
        <VBox styleClass="kpi-card kpi-card-highlight" HBox.hgrow="ALWAYS" spacing="14">
            <HBox spacing="12" alignment="CENTER_LEFT">
                <StackPane styleClass="kpi-icon-wrapper kpi-icon-highlight">
                    <FontIcon iconLiteral="fas-clock" styleClass="kpi-icon-light"/>
                </StackPane>
                <VBox spacing="2">
                    <Label text="EN ATTENTE" styleClass="kpi-title-light"/>
                    <Label text="En attente de traitement" styleClass="kpi-description-light"/>
                </VBox>
            </HBox>
            <HBox alignment="CENTER_LEFT" spacing="10">
                <Label text="4" styleClass="kpi-value-light"/>
                <Label text="transactions" styleClass="kpi-unit-light"/>
            </HBox>
        </VBox>
    </HBox>

    <!-- ═══════════════════════════════ MAIN CONTENT ═════════════════════════ -->
    <HBox spacing="24" VBox.vgrow="ALWAYS">
        <padding><Insets top="0" right="32" bottom="32" left="32"/></padding>

        <!-- ────────────────── LEFT : FORMULAIRE TRANSACTION ────────────────── -->
        <VBox styleClass="content-card" prefWidth="440" spacing="0">
            <HBox styleClass="card-header" spacing="14" alignment="CENTER_LEFT">
                <StackPane styleClass="card-header-icon">
                    <FontIcon iconLiteral="fas-receipt" styleClass="card-header-icon-glyph"/>
                </StackPane>
                <VBox spacing="2">
                    <Label text="Détails de la transaction" styleClass="card-header-title"/>
                    <Label text="Créer ou modifier une transaction" styleClass="card-header-subtitle"/>
                </VBox>
            </HBox>

            <ScrollPane styleClass="form-scroll" fitToWidth="true" VBox.vgrow="ALWAYS">
                <VBox styleClass="card-body" spacing="20">
                    <GridPane hgap="16" vgap="4">
                        <columnConstraints>
                            <ColumnConstraints percentWidth="50"/>
                            <ColumnConstraints percentWidth="50"/>
                        </columnConstraints>

                        <VBox spacing="4" GridPane.rowIndex="0" GridPane.columnIndex="0">
                            <Label text="Catégorie *" styleClass="form-label"/>
                            <ComboBox fx:id="cbCategorie" promptText="Sélectionner" styleClass="combo-box" maxWidth="Infinity">
                                <items><FXCollections fx:factory="observableArrayList">
                                    <String fx:value="Alimentation"/>
                                    <String fx:value="Transport"/>
                                    <String fx:value="Factures"/>
                                    <String fx:value="Salaire"/>
                                    <String fx:value="Education"/>
                                </FXCollections></items>
                            </ComboBox>
                            <Label fx:id="lblCategorieError" styleClass="error-label" text="" wrapText="true"/>
                        </VBox>

                        <VBox spacing="4" GridPane.rowIndex="0" GridPane.columnIndex="1">
                            <Label text="Type *" styleClass="form-label"/>
                            <ComboBox fx:id="cbType" promptText="Sélectionner" styleClass="combo-box" maxWidth="Infinity">
                                <items><FXCollections fx:factory="observableArrayList">
                                    <String fx:value="Debit"/>
                                    <String fx:value="Credit"/>
                                </FXCollections></items>
                            </ComboBox>
                            <Label fx:id="lblTypeError" styleClass="error-label" text="" wrapText="true"/>
                        </VBox>

                        <VBox spacing="4" GridPane.rowIndex="1" GridPane.columnIndex="0">
                            <Label text="Montant *" styleClass="form-label"/>
                            <HBox styleClass="input-group">
                                <StackPane styleClass="input-prefix input-prefix-currency">
                                    <Label text="DT" styleClass="input-prefix-text"/>
                                </StackPane>
                                <TextField fx:id="txtMontant" promptText="0.00" styleClass="text-field input-with-prefix" HBox.hgrow="ALWAYS"/>
                            </HBox>
                            <Label fx:id="lblMontantError" styleClass="error-label" text="" wrapText="true"/>
                        </VBox>

                        <VBox spacing="4" GridPane.rowIndex="1" GridPane.columnIndex="1">
                            <Label text="Date *" styleClass="form-label"/>
                            <DatePicker fx:id="dpDate" styleClass="date-picker" maxWidth="Infinity"/>
                            <Label fx:id="lblDateError" styleClass="error-label" text="" wrapText="true"/>
                        </VBox>

                        <VBox spacing="4" GridPane.rowIndex="2" GridPane.columnIndex="0" GridPane.columnSpan="2">
                            <Label text="Statut *" styleClass="form-label"/>
                            <ComboBox fx:id="cbStatut" promptText="Sélectionner" styleClass="combo-box" maxWidth="Infinity">
                                <items><FXCollections fx:factory="observableArrayList">
                                    <String fx:value="En attente"/>
                                    <String fx:value="Terminee"/>
                                    <String fx:value="Echouee"/>
                                    <String fx:value="Annulee"/>
                                </FXCollections></items>
                            </ComboBox>
                            <Label fx:id="lblStatutError" styleClass="error-label" text="" wrapText="true"/>
                        </VBox>

                        <VBox spacing="4" GridPane.rowIndex="3" GridPane.columnIndex="0" GridPane.columnSpan="2">
                            <Label text="Description" styleClass="form-label"/>
                            <TextArea fx:id="txtDescription" promptText="Saisir les détails..." prefRowCount="3" styleClass="text-area"/>
                            <Label fx:id="lblDescriptionError" styleClass="error-label" text="" wrapText="true"/>
                        </VBox>
                    </GridPane>

                    <HBox spacing="10" alignment="CENTER_RIGHT" styleClass="form-actions">
                        <Button styleClass="btn-outline" onAction="#clearForm">
                            <graphic><HBox spacing="6" alignment="CENTER">
                                <FontIcon iconLiteral="fas-eraser" styleClass="btn-icon"/>
                                <Label text="Vider" styleClass="btn-label"/>
                            </HBox></graphic>
                        </Button>
                        <Button styleClass="btn-danger" onAction="#deleteTransaction">
                            <graphic><HBox spacing="6" alignment="CENTER">
                                <FontIcon iconLiteral="fas-trash-alt" styleClass="btn-icon-light"/>
                                <Label text="Supprimer" styleClass="btn-label-light"/>
                            </HBox></graphic>
                        </Button>
                        <Button fx:id="btnAjouter" styleClass="btn-primary" onAction="#saveTransaction">
                            <graphic><HBox spacing="6" alignment="CENTER">
                                <FontIcon iconLiteral="fas-check" styleClass="btn-icon-light"/>
                                <Label text="Enregistrer" styleClass="btn-label-light"/>
                            </HBox></graphic>
                        </Button>
                    </HBox>
                </VBox>
            </ScrollPane>
        </VBox>

        <!-- ────────────── RIGHT : CARTES TRANSACTIONS + RÉCLAMATION ────────── -->
        <VBox styleClass="content-card" HBox.hgrow="ALWAYS" spacing="0">

            <HBox styleClass="card-header" spacing="12" alignment="CENTER_LEFT">
                <StackPane styleClass="card-header-icon">
                    <FontIcon iconLiteral="fas-history" styleClass="card-header-icon-glyph"/>
                </StackPane>
                <VBox spacing="2">
                    <Label text="Historique des transactions" styleClass="card-header-title"/>
                    <Label fx:id="lblTableInfo" text="Total : 0 transaction" styleClass="card-header-subtitle"/>
                </VBox>
                <Region HBox.hgrow="ALWAYS"/>

                <HBox styleClass="search-container" spacing="0" alignment="CENTER_LEFT">
                    <StackPane styleClass="search-icon-wrapper">
                        <FontIcon iconLiteral="fas-search" styleClass="search-icon"/>
                    </StackPane>
                    <TextField fx:id="txtRecherche" promptText="Rechercher..." styleClass="search-input" prefWidth="185"/>
                </HBox>

                <Separator orientation="VERTICAL" style="-fx-padding:6 0 6 0;"/>

                <ComboBox fx:id="cbSortCritere"
                          promptText="Trier par..."
                          styleClass="filter-dropdown"
                          prefWidth="170">
                    <items>
                        <FXCollections fx:factory="observableArrayList">
                            <String fx:value="Date récente"/>
                            <String fx:value="Date ancienne"/>
                            <String fx:value="Montant décroissant"/>
                            <String fx:value="Montant croissant"/>
                            <String fx:value="Statut A-Z"/>
                        </FXCollections>
                    </items>
                </ComboBox>

                <Button styleClass="header-btn-secondary" onAction="#appliquerTri">
                    <graphic>
                        <HBox spacing="7" alignment="CENTER">
                            <FontIcon iconLiteral="fas-sort-amount-down" styleClass="header-btn-icon"/>
                            <Label text="Trier" styleClass="header-btn-label"/>
                        </HBox>
                    </graphic>
                </Button>
            </HBox>

            <!-- Zone cartes transactions -->
            <ScrollPane fx:id="transactionsScrollPane"
                        styleClass="transactions-scroll"
                        fitToWidth="true"
                        VBox.vgrow="ALWAYS"
                        hbarPolicy="NEVER">
                <VBox fx:id="transactionsCardsContainer" spacing="12">
                    <padding><Insets top="16" right="20" bottom="20" left="20"/></padding>
                </VBox>
            </ScrollPane>

            <!-- Panel : Formulaire réclamation -->
            <VBox fx:id="reclamationFormContainer" styleClass="complaint-form-container"
                  spacing="0" visible="false" managed="false">
                <Separator styleClass="section-divider"/>
                <HBox styleClass="complaint-form-header" spacing="12" alignment="CENTER_LEFT">
                    <StackPane styleClass="complaint-form-icon">
                        <FontIcon iconLiteral="fas-exclamation-triangle" styleClass="complaint-form-icon-glyph"/>
                    </StackPane>
                    <VBox spacing="2" HBox.hgrow="ALWAYS">
                        <Label text="Déposer une réclamation" styleClass="complaint-form-title"/>
                        <Label fx:id="lblReclamationTransactionInfo" text="—"
                               styleClass="complaint-form-subtitle" wrapText="true"/>
                    </VBox>
                    <Button styleClass="btn-icon-close" onAction="#hideReclamationForm">
                        <graphic><FontIcon iconLiteral="fas-times" styleClass="close-icon"/></graphic>
                    </Button>
                </HBox>
                <VBox styleClass="complaint-form-body" spacing="16">
                    <GridPane hgap="16" vgap="6">
                        <columnConstraints>
                            <ColumnConstraints percentWidth="50"/>
                            <ColumnConstraints percentWidth="50"/>
                        </columnConstraints>
                        <VBox spacing="4" GridPane.rowIndex="0" GridPane.columnIndex="0">
                            <Label text="Type de réclamation *" styleClass="form-label"/>
                            <ComboBox fx:id="cbTypeReclamation" promptText="Sélectionner"
                                      styleClass="combo-box" maxWidth="Infinity">
                                <items><FXCollections fx:factory="observableArrayList">
                                    <String fx:value="Virement_non_recu"/>
                                    <String fx:value="Erreur_montant"/>
                                    <String fx:value="Transaction inconnue"/>
                                    <String fx:value="Probleme carte"/>
                                    <String fx:value="Autre"/>
                                </FXCollections></items>
                            </ComboBox>
                            <Label fx:id="lblTypeReclamationError" styleClass="error-label" text="" wrapText="true"/>
                        </VBox>
                        <VBox spacing="4" GridPane.rowIndex="0" GridPane.columnIndex="1">
                            <Label text="Priorité" styleClass="form-label"/>
                            <ComboBox fx:id="cbPrioriteReclamation" promptText="Sélectionner"
                                      styleClass="combo-box" maxWidth="Infinity">
                                <items><FXCollections fx:factory="observableArrayList">
                                    <String fx:value="Faible"/>
                                    <String fx:value="Moyen"/>
                                    <String fx:value="Eleve"/>
                                    <String fx:value="Critique"/>
                                </FXCollections></items>
                            </ComboBox>
                        </VBox>
                        <VBox spacing="4" GridPane.rowIndex="1" GridPane.columnIndex="0" GridPane.columnSpan="2">
                            <Label text="Description *" styleClass="form-label"/>
                            <TextArea fx:id="txtDescriptionReclamation"
                                      promptText="Décrivez le problème en détail (min. 10 caractères)..."
                                      prefRowCount="4" styleClass="text-area"/>
                            <Label fx:id="lblDescriptionReclamationError" styleClass="error-label" text="" wrapText="true"/>
                        </VBox>
                    </GridPane>
                    <HBox spacing="12" alignment="CENTER_RIGHT">
                        <Button styleClass="btn-outline" onAction="#hideReclamationForm">
                            <graphic><Label text="Annuler" styleClass="btn-label"/></graphic>
                        </Button>
                        <Button styleClass="btn-warning" onAction="#submitComplaint">
                            <graphic><HBox spacing="8" alignment="CENTER">
                                <FontIcon iconLiteral="fas-paper-plane" styleClass="btn-icon-light"/>
                                <Label text="Soumettre la réclamation" styleClass="btn-label-light"/>
                            </HBox></graphic>
                        </Button>
                    </HBox>
                </VBox>
            </VBox>

            <!-- Panel : Liste réclamations -->
            <VBox fx:id="reclamationsDisplayContainer" styleClass="complaints-list-container"
                  spacing="0" visible="false" managed="false">
                <Separator styleClass="section-divider"/>
                <HBox styleClass="complaints-list-header" spacing="12" alignment="CENTER_LEFT">
                    <StackPane styleClass="complaints-list-icon">
                        <FontIcon iconLiteral="fas-clipboard-list" styleClass="complaints-list-icon-glyph"/>
                    </StackPane>
                    <VBox spacing="2" HBox.hgrow="ALWAYS">
                        <Label text="Vos réclamations" styleClass="complaints-list-title"/>
                        <Label text="Suivre le statut de vos réclamations" styleClass="complaints-list-subtitle"/>
                    </VBox>
                    <Button styleClass="btn-outline-small" onAction="#hideReclamations">
                        <graphic><HBox spacing="4" alignment="CENTER">
                            <FontIcon iconLiteral="fas-times" styleClass="btn-icon-small"/>
                            <Label text="Fermer"/>
                        </HBox></graphic>
                    </Button>
                </HBox>
                <VBox styleClass="complaints-list-body" spacing="12">
                    <HBox styleClass="complaint-item" spacing="14" alignment="CENTER_LEFT">
                        <StackPane styleClass="complaint-status-indicator complaint-status-progress"/>
                        <VBox spacing="4" HBox.hgrow="ALWAYS">
                            <HBox spacing="8" alignment="CENTER_LEFT">
                                <Label text="REC-0077" styleClass="complaint-id"/>
                                <StackPane styleClass="complaint-badge badge-progress">
                                    <Label text="En cours"/>
                                </StackPane>
                            </HBox>
                            <Label text="Problème de paiement - TRX-1001" styleClass="complaint-description"/>
                            <Label text="Déposée : 19 Dec 2024" styleClass="complaint-date"/>
                        </VBox>
                        <Button styleClass="complaint-view-btn">
                            <graphic><FontIcon iconLiteral="fas-chevron-right" styleClass="complaint-view-icon"/></graphic>
                        </Button>
                    </HBox>
                    <HBox styleClass="complaint-item" spacing="14" alignment="CENTER_LEFT">
                        <StackPane styleClass="complaint-status-indicator complaint-status-resolved"/>
                        <VBox spacing="4" HBox.hgrow="ALWAYS">
                            <HBox spacing="8" alignment="CENTER_LEFT">
                                <Label text="REC-0065" styleClass="complaint-id"/>
                                <StackPane styleClass="complaint-badge badge-resolved">
                                    <Label text="Résolue"/>
                                </StackPane>
                            </HBox>
                            <Label text="Traitement retardé - TRX-0998" styleClass="complaint-description"/>
                            <Label text="Résolue : 15 Dec 2024" styleClass="complaint-date"/>
                        </VBox>
                        <Button styleClass="complaint-view-btn">
                            <graphic><FontIcon iconLiteral="fas-chevron-right" styleClass="complaint-view-icon"/></graphic>
                        </Button>
                    </HBox>
                </VBox>
            </VBox>

        </VBox>
    </HBox>
</VBox>
